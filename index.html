<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>å•è¯è®°å½•æœ¬</title>
<script>
  // æ³¨å†Œ Service Worker
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('/sw.js')
        .then(registration => {
          console.log('ServiceWorker æ³¨å†ŒæˆåŠŸ: ', registration.scope);
        })
        .catch(err => {
          console.log('ServiceWorker æ³¨å†Œå¤±è´¥: ', err);
        });
    });
  }
  
  // æ·»åŠ å®‰è£…æç¤º
  let deferredPrompt;
  
  window.addEventListener('beforeinstallprompt', (e) => {
    // é˜»æ­¢é»˜è®¤çš„å®‰è£…æç¤º
    e.preventDefault();
    // ä¿å­˜äº‹ä»¶ä»¥ä¾¿ç¨åè§¦å‘
    deferredPrompt = e;
    
    // æ˜¾ç¤ºä¸€ä¸ªè‡ªå®šä¹‰çš„å®‰è£…æŒ‰é’®
    const installButton = document.createElement('button');
    installButton.textContent = 'ğŸ“± å®‰è£…åº”ç”¨';
    installButton.style.position = 'fixed';
    installButton.style.bottom = '20px';
    installButton.style.right = '20px';
    installButton.style.padding = '10px 15px';
    installButton.style.backgroundColor = '#6366f1';
    installButton.style.color = 'white';
    installButton.style.border = 'none';
    installButton.style.borderRadius = '5px';
    installButton.style.cursor = 'pointer';
    installButton.style.zIndex = '1000';
    installButton.style.boxShadow = '0 4px 6px rgba(0,0,0,0.1)';
    installButton.style.fontSize = '14px';
    
    installButton.addEventListener('click', () => {
      // éšè—æŒ‰é’®
      installButton.style.display = 'none';
      // æ˜¾ç¤ºå®‰è£…æç¤º
      deferredPrompt.prompt();
      // ç­‰å¾…ç”¨æˆ·å“åº”
      deferredPrompt.userChoice.then((choiceResult) => {
        if (choiceResult.outcome === 'accepted') {
          console.log('ç”¨æˆ·æ¥å—äº†å®‰è£…');
        } else {
          console.log('ç”¨æˆ·å–æ¶ˆäº†å®‰è£…');
        }
        deferredPrompt = null;
      });
    });
    
    document.body.appendChild(installButton);
  });
</script>
<!-- Tailwind CSS CDN -->
<script src="https://cdn.tailwindcss.com"></script>
<!-- Google Fonts -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#6366f1">
<style>
/* åŸºç¡€æ ·å¼é‡ç½® */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Noto Sans SC', sans-serif;
    background: linear-gradient(135deg, #f5f7fa 0%, #e4e8f0 100%);
    color: #1f2937;
    line-height: 1.6;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
}

/* å®¹å™¨æ ·å¼ */
.container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 1rem;
}

@media (min-width: 640px) {
    .container {
        padding: 0 1.5rem;
    }
}

@media (min-width: 1024px) {
    .container {
        padding: 0 2rem;
    }
}

/* ç™»å½•å®¹å™¨ */
.login-container {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    z-index: 1000;
}

.login-card {
    background: white;
    border-radius: 1rem;
    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    padding: 2.5rem;
    width: 100%;
    max-width: 28rem;
    margin: 1rem;
}

/* åº”ç”¨å®¹å™¨ */
.app-container {
    display: none;
    min-height: 100vh;
    background: linear-gradient(135deg, #f5f7fa 0%, #e4e8f0 100%);
}

/* è¡¨å•æ ·å¼ */
.form-group {
    margin-bottom: 1.25rem;
}

.form-label {
    display: block;
    font-size: 0.875rem;
    font-weight: 500;
    color: #374151;
    margin-bottom: 0.5rem;
}

.form-input {
    width: 100%;
    padding: 0.75rem 1rem;
    border: 1px solid #d1d5db;
    border-radius: 0.5rem;
    font-size: 1rem;
    transition: all 0.2s ease-in-out;
    background-color: #f9fafb;
}

.form-input:focus {
    outline: none;
    border-color: #6366f1;
    box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
    background-color: white;
}

.form-textarea {
    resize: vertical;
    min-height: 2.5rem;
}

/* æŒ‰é’®æ ·å¼ */
.btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: 0.75rem 1.25rem;
    border: none;
    border-radius: 0.5rem;
    font-size: 1rem;
    font-weight: 500;
    text-decoration: none;
    cursor: pointer;
    transition: all 0.2s ease-in-out;
    box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
}

.btn-primary {
    background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%);
    color: white;
}

.btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
}

.btn-secondary {
    background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    color: white;
}

.btn-secondary:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
}

.btn-danger {
    background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
    color: white;
}

.btn-danger:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
}

.btn-warning {
    background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
    color: white;
}

.btn-warning:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
}

.btn-info {
    background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
    color: white;
}

.btn-info:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
}

.btn-full {
    width: 100%;
}

/* å¡ç‰‡æ ·å¼ */
.card {
    background: white;
    border-radius: 1rem;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    padding: 1.5rem;
    margin-bottom: 1.5rem;
    transition: all 0.3s ease;
}

.card:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
}

/* å•è¯å¡ç‰‡æ ·å¼ */
.word-cards-container {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
}

.word-card {
    position: relative;
    height: 220px;
    perspective: 1000px;
    margin-bottom: 1rem;
}

.word-card-inner {
    position: relative;
    width: 100%;
    height: 100%;
    text-align: center;
    transition: transform 0.6s;
    transform-style: preserve-3d;
    cursor: pointer;
}

.word-card.flipped .word-card-inner {
    transform: rotateY(180deg);
}

.word-card-front, .word-card-back {
    position: absolute;
    width: 100%;
    height: 100%;
    backface-visibility: hidden;
    border-radius: 1rem;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    overflow: hidden;
}

.word-card-front {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    padding: 1.5rem;
}

.word-card-back {
    background-color: white;
    color: #1f2937;
    transform: rotateY(180deg);
    padding: 1.5rem;
    overflow-y: auto;
}

.word-title {
    font-size: 2rem;
    font-weight: 700;
    margin-bottom: 0.5rem;
}

.word-date {
    font-size: 0.875rem;
    opacity: 0.8;
}

.word-detail {
    margin-bottom: 0.75rem;
    text-align: left;
}

.word-detail-title {
    font-weight: 600;
    color: #4f46e5;
    margin-bottom: 0.25rem;
    font-size: 0.875rem;
}

.word-detail-content {
    font-size: 0.875rem;
    color: #6b7280;
}

.word-card-actions {
    position: absolute;
    top: 0.75rem;
    right: 0.75rem;
    display: flex;
    gap: 0.5rem;
}

.word-card-btn {
    background: rgba(255, 255, 255, 0.2);
    border: none;
    border-radius: 50%;
    width: 2.5rem;
    height: 2.5rem;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    transition: all 0.2s ease;
    font-size: 1.25rem;
}

.word-card-btn:hover {
    background: rgba(255, 255, 255, 0.3);
    transform: scale(1.1);
}

.word-card-back .word-card-btn {
    background: rgba(0, 0, 0, 0.1);
}

.word-card-back .word-card-btn:hover {
    background: rgba(0, 0, 0, 0.2);
}

.word-mastered {
    opacity: 0.7;
}

.word-mastered .word-title {
    text-decoration: line-through;
}

/* æ—¥æœŸåˆ†ç»„æ ‡é¢˜ */
.date-group-title {
    font-size: 1.25rem;
    font-weight: 600;
    color: #374151;
    margin: 2rem 0 1rem 0;
    padding-bottom: 0.5rem;
    border-bottom: 1px solid #e5e7eb;
}

/* ç»Ÿè®¡å¡ç‰‡ */
.stats-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 1rem;
    margin-bottom: 1.5rem;
}

@media (min-width: 768px) {
    .stats-grid {
        grid-template-columns: repeat(4, 1fr);
    }
}

.stat-card {
    background: white;
    border-radius: 1rem;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    padding: 1.25rem;
    text-align: center;
    transition: all 0.3s ease;
}

.stat-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
}

.stat-label {
    font-size: 0.75rem;
    color: #6b7280;
    margin-bottom: 0.5rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.stat-value {
    font-size: 1.75rem;
    font-weight: 700;
}

/* å¤´éƒ¨æ ·å¼ */
.header {
    background: white;
    border-bottom: 1px solid #e5e7eb;
    position: sticky;
    top: 0;
    z-index: 100;
    box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
}

.header-content {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem 0;
}

.user-info {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.875rem;
}

.user-name {
    font-weight: 500;
}

.header-actions {
    display: flex;
    gap: 1rem;
}

.header-btn {
    background: none;
    border: none;
    color: #3b82f6;
    cursor: pointer;
    font-size: 0.875rem;
    text-decoration: none;
    padding: 0.5rem 1rem;
    border-radius: 0.5rem;
    transition: all 0.2s ease;
}

.header-btn:hover {
    background-color: #f3f4f6;
    color: #2563eb;
}

.header-btn.danger {
    color: #ef4444;
}

.header-btn.danger:hover {
    background-color: #fef2f2;
    color: #dc2626;
}

/* æ¨¡æ€æ¡†æ ·å¼ */
.modal {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: rgba(0, 0, 0, 0.5);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 1000;
}

.modal.show {
    display: flex;
}

.modal-content {
    background: white;
    border-radius: 1rem;
    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    padding: 2rem;
    width: 100%;
    max-width: 32rem;
    max-height: 80vh;
    overflow-y: auto;
    margin: 1rem;
}

.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
}

.modal-title {
    font-size: 1.5rem;
    font-weight: 700;
    color: #1f2937;
}

.modal-close {
    background: none;
    border: none;
    font-size: 1.5rem;
    cursor: pointer;
    color: #6b7280;
    width: 2.5rem;
    height: 2.5rem;
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    transition: all 0.2s ease;
}

.modal-close:hover {
    background-color: #f3f4f6;
    color: #374151;
}

/* åŠ è½½åŠ¨ç”» */
.loading {
    display: inline-block;
    width: 1.5rem;
    height: 1.5rem;
    border: 2px solid #f3f4f6;
    border-top: 2px solid #3b82f6;
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* æç¤ºæ¶ˆæ¯ */
.toast {
    position: fixed;
    top: 1rem;
    left: 50%;
    transform: translateX(-50%) translateY(-100px);
    background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    color: white;
    padding: 1rem 1.5rem;
    border-radius: 0.5rem;
    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    opacity: 0;
    transition: all 0.3s ease-in-out;
    z-index: 2000;
}

.toast.show {
    transform: translateX(-50%) translateY(0);
    opacity: 1;
}

/* åŒæ­¥çŠ¶æ€ */
.sync-status {
    position: fixed;
    bottom: 1rem;
    right: 1rem;
    background-color: rgba(0, 0, 0, 0.7);
    color: white;
    padding: 0.75rem 1rem;
    border-radius: 9999px;
    font-size: 0.875rem;
    display: none;
    z-index: 1000;
}

.sync-status.show {
    display: block;
}

/* éšè—ç±» */
.hidden {
    display: none !important;
}

/* å“åº”å¼è®¾è®¡ */
@media (max-width: 640px) {
    .modal-content {
        margin: 0.5rem;
        max-height: 90vh;
    }
    
    .word-cards-container {
        grid-template-columns: 1fr;
    }
    
    .stats-grid {
        grid-template-columns: repeat(2, 1fr);
    }
}

/* åŠ¨ç”»æ•ˆæœ */
.fade-in {
    animation: fadeIn 0.3s ease-in-out;
}

@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(-10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* æ–‡ä»¶æ‹–æ”¾åŒºåŸŸ */
.file-drop {
    border: 2px dashed #d1d5db;
    border-radius: 0.5rem;
    padding: 2rem;
    text-align: center;
    cursor: pointer;
    transition: all 0.15s ease-in-out;
}

.file-drop:hover {
    border-color: #6366f1;
    background-color: #f9fafb;
}

.file-drop.dragover {
    border-color: #6366f1;
    background-color: #eef2ff;
}

/* é”™è¯¯æ¶ˆæ¯ */
.error-message {
    color: #ef4444;
    font-size: 0.875rem;
    margin-top: 0.5rem;
    padding: 0.5rem;
    background-color: #fef2f2;
    border-radius: 0.25rem;
    display: none;
}

.error-message.show {
    display: block;
}

/* è¡¨æ ¼æ ·å¼ */
.table-container {
    max-height: 300px;
    overflow-y: auto;
    margin: 1rem 0;
}

.table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.875rem;
}

.table th,
.table td {
    border: 1px solid #e5e7eb;
    padding: 0.5rem;
    text-align: left;
}

.table th {
    background-color: #f9fafb;
    position: sticky;
    top: 0;
}

.table tr:nth-child(even) {
    background-color: #f9fafb;
}

.table tr:hover {
    background-color: #f3f4f6;
}

/* å­¦ä¹ æ¨¡å¼åˆ‡æ¢ */
.view-toggle {
    display: flex;
    justify-content: center;
    margin-bottom: 1.5rem;
    background: white;
    border-radius: 0.5rem;
    padding: 0.25rem;
    box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
}

.view-toggle-btn {
    background: transparent;
    border: none;
    padding: 0.5rem 1rem;
    cursor: pointer;
    transition: all 0.2s ease;
    border-radius: 0.375rem;
    font-weight: 500;
}

.view-toggle-btn.active {
    background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%);
    color: white;
}

/* ç©ºçŠ¶æ€ */
.empty-state {
    text-align: center;
    padding: 3rem 1rem;
    color: #6b7280;
}

.empty-state-icon {
    font-size: 4rem;
    margin-bottom: 1rem;
    opacity: 0.5;
}

.empty-state-text {
    font-size: 1.25rem;
    margin-bottom: 0.5rem;
    font-weight: 500;
}

.empty-state-subtext {
    font-size: 0.875rem;
}

/* å¤ä¹ æ¨¡å¼æ ·å¼ - å…¨æ–°ä¼˜åŒ–ç‰ˆæœ¬ */
.review-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 1rem 0;
    max-width: 100%;
}

.review-progress {
    width: 100%;
    max-width: 600px;
    margin-bottom: 1.5rem;
}

.progress-bar {
    width: 100%;
    height: 0.75rem;
    background-color: #e5e7eb;
    border-radius: 9999px;
    overflow: hidden;
    margin-bottom: 0.5rem;
}

.progress-fill {
    height: 100%;
    background: linear-gradient(90deg, #10b981 0%, #059669 100%);
    border-radius: 9999px;
    transition: width 0.5s ease;
}

.progress-text {
    text-align: center;
    font-size: 0.875rem;
    color: #6b7280;
    font-weight: 500;
}

.review-card-container {
    width: 100%;
    max-width: 500px;
    height: 350px;
    perspective: 1000px;
    margin-bottom: 1.5rem;
}

.review-card-inner {
    position: relative;
    width: 100%;
    height: 100%;
    text-align: center;
    transition: transform 0.6s;
    transform-style: preserve-3d;
    cursor: pointer;
}

.review-card.flipped .review-card-inner {
    transform: rotateY(180deg);
}

.review-card-front, .review-card-back {
    position: absolute;
    width: 100%;
    height: 100%;
    backface-visibility: hidden;
    border-radius: 1rem;
    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    padding: 2rem;
}

.review-card-front {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
}

.review-card-back {
    background-color: white;
    color: #1f2937;
    transform: rotateY(180deg);
}

.review-word {
    font-size: 2.5rem;
    font-weight: 700;
    margin-bottom: 1rem;
}

.review-hint {
    font-size: 0.875rem;
    opacity: 0.8;
    padding: 0.5rem 1rem;
    background-color: rgba(255, 255, 255, 0.2);
    border-radius: 2rem;
}

.review-card-back .review-hint {
    background-color: rgba(0, 0, 0, 0.05);
    color: #6b7280;
}

.review-detail {
    width: 100%;
    text-align: left;
    margin-bottom: 1rem;
}

.review-detail-title {
    font-weight: 600;
    color: #4f46e5;
    margin-bottom: 0.5rem;
    font-size: 1rem;
}

.review-detail-content {
    font-size: 1rem;
    color: #4b5563;
    line-height: 1.5;
}

.review-complete {
    text-align: center;
    padding: 2rem;
}

.review-complete-icon {
    font-size: 4rem;
    margin-bottom: 1rem;
}

.review-complete-text {
    font-size: 1.5rem;
    font-weight: 600;
    margin-bottom: 0.5rem;
}

.review-complete-subtext {
    font-size: 1rem;
    color: #6b7280;
    margin-bottom: 2rem;
}

/* æ—¥æœŸé€‰æ‹©å™¨æ ·å¼ */
.date-selector {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
    gap: 0.75rem;
    margin-bottom: 1.5rem;
}

.date-option {
    padding: 0.75rem;
    border: 1px solid #e5e7eb;
    border-radius: 0.5rem;
    text-align: center;
    cursor: pointer;
    transition: all 0.2s ease;
    background: white;
}

.date-option:hover {
    border-color: #6366f1;
    background-color: #f3f4f6;
}

.date-option.selected {
    border-color: #6366f1;
    background-color: #eef2ff;
    color: #4f46e5;
    font-weight: 500;
}

.date-option-text {
    font-size: 0.875rem;
    margin-bottom: 0.25rem;
}

.date-option-count {
    font-size: 0.75rem;
    color: #6b7280;
}

.date-option.selected .date-option-count {
    color: #4f46e5;
}

/* åŠŸèƒ½æŒ‰é’®ç»„ */
.feature-buttons {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
    margin-bottom: 2rem;
}

.feature-btn {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 1.5rem;
    background: white;
    border: 1px solid #e5e7eb;
    border-radius: 1rem;
    text-decoration: none;
    color: #374151;
    transition: all 0.3s ease;
    cursor: pointer;
}

.feature-btn:hover {
    transform: translateY(-4px);
    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    border-color: #6366f1;
}

.feature-btn-icon {
    font-size: 2.5rem;
    margin-bottom: 0.75rem;
}

.feature-btn-text {
    font-size: 1rem;
    font-weight: 500;
    margin-bottom: 0.25rem;
}

.feature-btn-desc {
    font-size: 0.75rem;
    color: #6b7280;
    text-align: center;
}

/* ç§»åŠ¨ç«¯ä¼˜åŒ– */
@media (max-width: 640px) {
    .review-word {
        font-size: 2rem;
    }
    
    .review-card-container {
        height: 300px;
    }
    
    .review-card-front, .review-card-back {
        padding: 1.5rem;
    }
    
    .review-detail-content {
        font-size: 0.875rem;
    }
    
    .date-selector {
        grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
        gap: 0.5rem;
    }
    
    .date-option {
        padding: 0.5rem;
    }
    
    .date-option-text {
        font-size: 0.75rem;
    }
    
    .date-option-count {
        font-size: 0.625rem;
    }
}

/* åˆ—è¡¨è§†å›¾ä¼˜åŒ– */
.word-list-container {
    width: 100%;
}

.word-list-item {
    background: white;
    border-radius: 0.75rem;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    margin-bottom: 1rem;
    overflow: hidden;
    transition: all 0.2s ease;
}

.word-list-item:hover {
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    transform: translateY(-2px);
}

.word-list-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem;
    background-color: #f8f9fa;
    border-bottom: 1px solid #e9ecef;
}

.word-list-title {
    font-size: 1.25rem;
    font-weight: 600;
    color: #1f2937;
    margin: 0;
}

.word-list-count {
    font-size: 0.875rem;
    color: #6b7280;
    background-color: #e9ecef;
    padding: 0.25rem 0.75rem;
    border-radius: 1rem;
}

.word-list-content {
    padding: 1rem;
}

.word-item {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    padding: 1rem;
    border-bottom: 1px solid #f3f4f6;
    transition: all 0.2s ease;
}

.word-item:last-child {
    border-bottom: none;
}

.word-item:hover {
    background-color: #f9fafb;
}

.word-item.mastered {
    opacity: 0.7;
}

.word-item.mastered .word-item-title {
    text-decoration: line-through;
}

.word-item-content {
    flex: 1;
}

.word-item-title {
    font-size: 1.125rem;
    font-weight: 600;
    color: #1f2937;
    margin-bottom: 0.5rem;
}

.word-item-details {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
}

.word-item-detail {
    background-color: #f3f4f6;
    border-radius: 0.25rem;
    padding: 0.25rem 0.5rem;
    font-size: 0.875rem;
    color: #4b5563;
}

.word-item-detail-title {
    font-weight: 500;
    margin-right: 0.25rem;
}

.word-item-actions {
    display: flex;
    gap: 0.5rem;
    margin-left: 1rem;
}

.word-item-btn {
    width: 2.5rem;
    height: 2.5rem;
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    border: none;
    cursor: pointer;
    transition: all 0.2s ease;
    font-size: 1.25rem;
}

.word-item-btn-master {
    background-color: #e0f2fe;
    color: #0284c7;
}

.word-item-btn-master:hover {
    background-color: #bae6fd;
}

.word-item-btn-master.mastered {
    background-color: #dcfce7;
    color: #16a34a;
}

.word-item-btn-master.mastered:hover {
    background-color: #bbf7d0;
}

.word-item-btn-delete {
    background-color: #fee2e2;
    color: #dc2626;
}

.word-item-btn-delete:hover {
    background-color: #fecaca;
}

.word-item-btn-edit {
    background-color: #e0e7ff;
    color: #4f46e5;
}

.word-item-btn-edit:hover {
    background-color: #c7d2fe;
}

/* å¤ä¹ ç•Œé¢å¢å¼º */
.review-actions {
    display: flex;
    justify-content: center;
    gap: 1rem;
    margin-top: 1.5rem;
}

.review-btn {
    padding: 0.75rem 1.5rem;
    border-radius: 0.5rem;
    border: none;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.review-btn-know {
    background-color: #dcfce7;
    color: #16a34a;
}

.review-btn-know:hover {
    background-color: #bbf7d0;
}

.review-btn-unknown {
    background-color: #fee2e2;
    color: #dc2626;
}

.review-btn-unknown:hover {
    background-color: #fecaca;
}

.review-btn-next {
    background-color: #e0f2fe;
    color: #0284c7;
}

.review-btn-next:hover {
    background-color: #bae6fd;
}

/* å¤ä¹ ç•Œé¢å¡ç‰‡ä¼˜åŒ– */
.review-card {
    position: relative;
    width: 100%;
    height: 100%;
}

.review-card-hint {
    position: absolute;
    bottom: 1rem;
    left: 0;
    right: 0;
    text-align: center;
    font-size: 0.875rem;
    opacity: 0.8;
    padding: 0.5rem;
}

.review-card-front .review-card-hint {
    color: white;
    background-color: rgba(0, 0, 0, 0.2);
    border-radius: 2rem;
    margin: 0 2rem;
}

.review-card-back .review-card-hint {
    color: #6b7280;
    background-color: rgba(0, 0, 0, 0.05);
    border-radius: 0.5rem;
    margin: 0 1rem;
}

/* å¤ä¹ è¿›åº¦æ¡ä¼˜åŒ– */
.review-progress-container {
    width: 100%;
    max-width: 600px;
    margin-bottom: 1.5rem;
}

.review-progress-info {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.5rem;
}

.review-progress-text {
    font-size: 0.875rem;
    color: #6b7280;
    font-weight: 500;
}

.review-progress-percentage {
    font-size: 0.875rem;
    color: #4f46e5;
    font-weight: 600;
}

.review-progress-bar {
    width: 100%;
    height: 0.75rem;
    background-color: #e5e7eb;
    border-radius: 9999px;
    overflow: hidden;
}

.review-progress-fill {
    height: 100%;
    background: linear-gradient(90deg, #6366f1 0%, #4f46e5 100%);
    border-radius: 9999px;
    transition: width 0.5s ease;
}

/* å¤ä¹ æ—¥æœŸé€‰æ‹©ä¼˜åŒ– */
.review-date-selector {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
    gap: 0.75rem;
    margin-bottom: 1.5rem;
}

.review-date-option {
    padding: 1rem;
    border: 1px solid #e5e7eb;
    border-radius: 0.5rem;
    text-align: center;
    cursor: pointer;
    transition: all 0.2s ease;
    background: white;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
}

.review-date-option:hover {
    border-color: #6366f1;
    background-color: #f3f4f6;
    transform: translateY(-2px);
}

.review-date-option.selected {
    border-color: #6366f1;
    background-color: #eef2ff;
    color: #4f46e5;
    font-weight: 500;
    transform: translateY(-2px);
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
}

.review-date-option-icon {
    font-size: 1.5rem;
    margin-bottom: 0.5rem;
}

.review-date-option-text {
    font-size: 0.875rem;
    margin-bottom: 0.25rem;
    font-weight: 500;
}

.review-date-option-count {
    font-size: 0.75rem;
    color: #6b7280;
}

.review-date-option.selected .review-date-option-count {
    color: #4f46e5;
}
</style>
</head>
<body>
<!-- åŠ è½½é®ç½© -->
<div id="loading-overlay" class="loading-overlay" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(255, 255, 255, 0.9); display: flex; justify-content: center; align-items: center; z-index: 9999;">
    <div style="text-align: center;">
        <div class="loading"></div>
        <p style="margin-top: 0.5rem; color: #374151;">æ­£åœ¨åˆå§‹åŒ–åº”ç”¨...</p>
        <p id="loading-status" style="font-size: 0.875rem; color: #6b7280; margin-top: 0.25rem;"></p>
    </div>
</div>

<!-- ç™»å½•ç•Œé¢ -->
<div id="login-container" class="login-container">
    <div class="login-card">
        <h2 style="font-size: 1.75rem; font-weight: 700; text-align: center; margin-bottom: 1.5rem;">ğŸ“š å•è¯è®°å½•æœ¬</h2>
        
        <form id="login-form">
            <div class="form-group">
                <label for="username" class="form-label">ç”¨æˆ·å</label>
                <input type="text" id="username" class="form-input" placeholder="è¾“å…¥æ‚¨çš„ç”¨æˆ·å" required>
            </div>
            
            <div class="form-group">
                <label for="password" class="form-label">å¯†ç </label>
                <input type="password" id="password" class="form-input" placeholder="è¾“å…¥æ‚¨çš„å¯†ç " required>
            </div>
            
            <div class="form-group">
                <label style="display: flex; align-items: center; font-size: 0.875rem; color: #6b7280;">
                    <input type="checkbox" id="use-local" style="margin-right: 0.5rem;">
                    ä½¿ç”¨æœ¬åœ°å­˜å‚¨ï¼ˆç¦»çº¿æ¨¡å¼ï¼‰
                </label>
            </div>
            
            <button type="submit" class="btn btn-primary btn-full" id="login-btn">
                <span id="login-text">ç™»å½•</span>
                <div id="login-spinner" class="loading" style="display: none; margin-left: 0.5rem;"></div>
            </button>
            
            <p style="text-align: center; font-size: 0.875rem; color: #6b7280; margin-top: 1rem;">
                é¦–æ¬¡ä½¿ç”¨å°†è‡ªåŠ¨åˆ›å»ºè´¦æˆ·
            </p>
        </form>
    </div>
</div>

<!-- ä¸»åº”ç”¨ç•Œé¢ -->
<div id="app-container" class="app-container">
    <!-- ç”¨æˆ·ä¿¡æ¯æ  -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="user-info">
                    <span>ç”¨æˆ·:</span>
                    <span id="current-user" class="user-name"></span>
                </div>
                <div class="header-actions">
                    <button id="sync-btn" class="header-btn">
                        <div id="sync-spinner" class="loading" style="display: none; margin-right: 0.25rem;"></div>
                        <span id="sync-text">æ‰‹åŠ¨åŒæ­¥</span>
                    </button>
                    <button id="logout-btn" class="header-btn danger">é€€å‡ºç™»å½•</button>
                </div>
            </div>
        </div>
    </header>

    <div class="container" style="padding-top: 1.5rem; padding-bottom: 3rem;">
        <!-- æ ‡é¢˜ -->
        <div style="text-align: center; margin-bottom: 2rem;">
            <h1 style="font-size: 2.5rem; font-weight: 700; color: #1f2937; margin-bottom: 0.5rem;">ğŸ“š æ¯æ—¥å•è¯è®°å½•æœ¬</h1>
            <p style="color: #6b7280; font-size: 1.125rem;">è®°å½•ä½ çš„æ¯ä¸€ç‚¹è¿›æ­¥</p>
        </div>

        <!-- åŠŸèƒ½æŒ‰é’®ç»„ -->
        <div class="feature-buttons">
            <div class="feature-btn" id="add-word-btn">
                <div class="feature-btn-icon">â•</div>
                <div class="feature-btn-text">æ·»åŠ å•è¯</div>
                <div class="feature-btn-desc">è®°å½•æ–°å­¦ä¹ çš„å•è¯</div>
            </div>
            
            <div class="feature-btn" id="review-btn">
                <div class="feature-btn-icon">ğŸ“–</div>
                <div class="feature-btn-text">å¤ä¹ å•è¯</div>
                <div class="feature-btn-desc">å¤ä¹ å·²å­¦ä¹ çš„å•è¯</div>
            </div>
            
            <div class="feature-btn" id="export-trigger-btn">
                <div class="feature-btn-icon">ğŸ“Š</div>
                <div class="feature-btn-text">å¯¼å‡ºæ•°æ®</div>
                <div class="feature-btn-desc">å¯¼å‡ºä¸ºExcelæ–‡ä»¶</div>
            </div>
            
            <div class="feature-btn" id="import-trigger-btn">
                <div class="feature-btn-icon">ğŸ“¥</div>
                <div class="feature-btn-text">å¯¼å…¥æ•°æ®</div>
                <div class="feature-btn-desc">ä»Excelæ–‡ä»¶å¯¼å…¥</div>
            </div>
        </div>

        <!-- ç»Ÿè®¡å¡ç‰‡ -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">æ€»è¯æ±‡é‡</div>
                <div id="total-words" class="stat-value" style="color: #6366f1;">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">å­¦ä¹ å¤©æ•°</div>
                <div id="study-days" class="stat-value" style="color: #10b981;">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">ä»Šæ—¥æ–°è¯</div>
                <div id="today-words" class="stat-value" style="color: #3b82f6;">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">å·²æŒæ¡</div>
                <div id="mastered-words" class="stat-value" style="color: #8b5cf6;">0</div>
            </div>
        </div>

        <!-- è§†å›¾åˆ‡æ¢ -->
        <div class="view-toggle">
            <button id="card-view-btn" class="view-toggle-btn active">å¡ç‰‡è§†å›¾</button>
            <button id="list-view-btn" class="view-toggle-btn">åˆ—è¡¨è§†å›¾</button>
        </div>

        <!-- å•è¯åˆ—è¡¨ -->
        <section id="word-list-container">
            <!-- å•è¯å°†åœ¨è¿™é‡ŒåŠ¨æ€æ’å…¥ -->
        </section>
    </div>
</div>

<!-- æ·»åŠ å•è¯æ¨¡æ€æ¡† -->
<div id="add-word-modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title">æ·»åŠ æ–°å•è¯</h3>
            <button class="modal-close" id="close-add-modal-btn">&times;</button>
        </div>
        
        <form id="word-form">
            <div class="form-group">
                <label for="word-input" class="form-label">å•è¯</label>
                <input type="text" id="word-input" class="form-input" placeholder="åŠ æ²¹åŠ æ²¹" required>
            </div>
            
            <div class="form-group">
                <label for="meaning-input" class="form-label">é‡Šä¹‰</label>
                <textarea id="meaning-input" class="form-input form-textarea" placeholder="ä¿æŒå¥½å¿ƒæƒ…"></textarea>
            </div>
            
            <div class="form-group">
                <label for="synonym-input" class="form-label">åŒä¹‰è¯</label>
                <textarea id="synonym-input" class="form-input form-textarea" placeholder="æˆ‘è¦èƒŒå•è¯ï¼"></textarea>
            </div>
            
            <div class="form-group">
                <label for="phrase-input" class="form-label">è¯ç»„</label>
                <textarea id="phrase-input" class="form-input form-textarea" placeholder="æˆ‘çˆ±å­¦ä¹ ï¼"></textarea>
            </div>
            
            <button type="submit" class="btn btn-primary btn-full">æ·»åŠ å•è¯</button>
        </form>
    </div>
</div>

<!-- ç¼–è¾‘å•è¯æ¨¡æ€æ¡† -->
<div id="edit-word-modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title">ç¼–è¾‘å•è¯</h3>
            <button class="modal-close" id="close-edit-modal-btn">&times;</button>
        </div>
        
        <form id="edit-word-form">
            <input type="hidden" id="edit-word-id">
            <input type="hidden" id="edit-word-date">
            
            <div class="form-group">
                <label for="edit-word-input" class="form-label">å•è¯</label>
                <input type="text" id="edit-word-input" class="form-input" required>
            </div>
            
            <div class="form-group">
                <label for="edit-meaning-input" class="form-label">é‡Šä¹‰</label>
                <textarea id="edit-meaning-input" class="form-input form-textarea"></textarea>
            </div>
            
            <div class="form-group">
                <label for="edit-synonym-input" class="form-label">åŒä¹‰è¯</label>
                <textarea id="edit-synonym-input" class="form-input form-textarea"></textarea>
            </div>
            
            <div class="form-group">
                <label for="edit-phrase-input" class="form-label">è¯ç»„</label>
                <textarea id="edit-phrase-input" class="form-input form-textarea"></textarea>
            </div>
            
            <div class="form-group">
                <label style="display: flex; align-items: center; font-size: 0.875rem; color: #6b7280;">
                    <input type="checkbox" id="edit-mastered-checkbox" style="margin-right: 0.5rem;">
                    æ ‡è®°ä¸ºå·²æŒæ¡
                </label>
            </div>
            
            <button type="submit" class="btn btn-primary btn-full">ä¿å­˜ä¿®æ”¹</button>
        </form>
    </div>
</div>

<!-- å¤ä¹ æ¨¡æ€æ¡† -->
<div id="review-modal" class="modal">
    <div class="modal-content" style="max-width: 700px;">
        <div class="modal-header">
            <h3 class="modal-title">é€‰æ‹©å¤ä¹ æ—¥æœŸ</h3>
            <button class="modal-close" id="close-review-modal-btn">&times;</button>
        </div>
        
        <div id="review-date-options">
            <!-- æ—¥æœŸé€‰é¡¹å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
        </div>
        
        <div id="review-container" style="display: none;">
            <div class="review-progress-container">
                <div class="review-progress-info">
                    <div id="review-progress-text" class="review-progress-text">0 / 0</div>
                    <div id="review-progress-percentage" class="review-progress-percentage">0%</div>
                </div>
                <div class="review-progress-bar">
                    <div id="review-progress-fill" class="review-progress-fill" style="width: 0%"></div>
                </div>
            </div>
            
            <div class="review-card-container">
                <div id="review-card" class="review-card">
                    <div class="review-card-inner">
                        <div class="review-card-front">
                            <div id="review-word" class="review-word"></div>
                            <div class="review-card-hint">ç‚¹å‡»æŸ¥çœ‹é‡Šä¹‰</div>
                        </div>
                        <div class="review-card-back">
                            <div id="review-meaning" class="review-detail">
                                <div class="review-detail-title">é‡Šä¹‰</div>
                                <div id="review-meaning-content" class="review-detail-content"></div>
                            </div>
                            <div id="review-synonym" class="review-detail">
                                <div class="review-detail-title">åŒä¹‰è¯</div>
                                <div id="review-synonym-content" class="review-detail-content"></div>
                            </div>
                            <div id="review-phrase" class="review-detail">
                                <div class="review-detail-title">è¯ç»„</div>
                                <div id="review-phrase-content" class="review-detail-content"></div>
                            </div>
                            <div class="review-card-hint">ç‚¹å‡»è¿›å…¥ä¸‹ä¸€ä¸ªå•è¯</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="review-actions">
                <button id="review-btn-know" class="review-btn review-btn-know">
                    <span>âœ…</span>
                    <span>è®¤è¯†</span>
                </button>
                <button id="review-btn-unknown" class="review-btn review-btn-unknown">
                    <span>âŒ</span>
                    <span>ä¸è®¤è¯†</span>
                </button>
                <button id="review-btn-next" class="review-btn review-btn-next">
                    <span>â¡ï¸</span>
                    <span>ä¸‹ä¸€ä¸ª</span>
                </button>
            </div>
        </div>
        
        <div id="review-complete" style="display: none;">
            <div class="review-complete">
                <div class="review-complete-icon">ğŸ‰</div>
                <div class="review-complete-text">å¤ä¹ å®Œæˆï¼</div>
                <div class="review-complete-subtext">ä½ å·²ç»å¤ä¹ äº†æ‰€æœ‰å•è¯</div>
                <button id="review-close-btn" class="btn btn-primary">å…³é—­</button>
            </div>
        </div>
    </div>
</div>

<!-- å¯¼å‡ºæ¨¡æ€æ¡† -->
<div id="export-modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title">é€‰æ‹©å¯¼å‡ºæ—¥æœŸ</h3>
            <button class="modal-close" id="close-modal-btn">&times;</button>
        </div>
        <div id="export-options">
            <!-- é€‰é¡¹å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
        </div>
    </div>
</div>

<!-- å¯¼å…¥æ¨¡æ€æ¡† -->
<div id="import-modal" class="modal">
    <div class="modal-content" style="max-width: 42rem;">
        <div class="modal-header">
            <h3 class="modal-title">å¯¼å…¥Excelæ–‡ä»¶</h3>
            <button class="modal-close" id="close-import-modal-btn">&times;</button>
        </div>
        
        <div class="file-drop" id="file-drop-zone">
            <input type="file" id="import-file-input" accept=".xlsx,.xls" style="display: none;">
            <div style="color: #6b7280;">
                <svg style="width: 3rem; height: 3rem; margin: 0 auto 0.75rem; color: #9ca3af;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                </svg>
                <p style="font-size: 0.875rem;">ç‚¹å‡»é€‰æ‹©æ–‡ä»¶æˆ–æ‹–æ‹½Excelæ–‡ä»¶åˆ°æ­¤å¤„</p>
                <p style="font-size: 0.75rem; color: #9ca3af; margin-top: 0.25rem;">æ”¯æŒ .xlsx å’Œ .xls æ ¼å¼</p>
            </div>
        </div>
        
        <div id="import-error" class="error-message"></div>
        
        <div style="margin-bottom: 1rem;">
            <h4 style="font-size: 0.875rem; font-weight: 500; color: #374151; margin-bottom: 0.5rem;">å¯¼å…¥é€‰é¡¹</h4>
            <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                <label style="display: flex; align-items: center; font-size: 0.875rem;">
                    <input type="radio" name="import-option" value="merge" checked style="margin-right: 0.5rem;">
                    åˆå¹¶å¯¼å…¥ï¼ˆä¿ç•™ç°æœ‰æ•°æ®ï¼Œè·³è¿‡é‡å¤å•è¯ï¼‰
                </label>
                <label style="display: flex; align-items: center; font-size: 0.875rem;">
                    <input type="radio" name="import-option" value="replace" style="margin-right: 0.5rem;">
                    æ›¿æ¢å¯¼å…¥ï¼ˆåˆ é™¤ç°æœ‰æ•°æ®ï¼Œå®Œå…¨æ›¿æ¢ï¼‰
                </label>
            </div>
        </div>
        
        <div id="import-preview" style="display: none;">
            <h4 style="font-size: 0.875rem; font-weight: 500; color: #374151; margin-bottom: 0.5rem;">æ•°æ®é¢„è§ˆ</h4>
            <div class="table-container">
                <table class="table" id="preview-table">
                    <!-- é¢„è§ˆæ•°æ®å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                </table>
            </div>
            <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 1rem;">
                <p id="import-summary" style="font-size: 0.875rem; color: #6b7280;"></p>
                <div style="display: flex; gap: 0.5rem;">
                    <button id="cancel-import-btn" class="btn" style="background-color: #e5e7eb; color: #374151;">å–æ¶ˆ</button>
                    <button id="confirm-import-btn" class="btn btn-primary">ç¡®è®¤å¯¼å…¥</button>
                </div>
            </div>
        </div>
        
        <div id="import-status" style="display: none; text-align: center; padding: 1rem;">
            <div class="loading" style="margin: 0 auto 0.5rem;"></div>
            <p style="font-size: 0.875rem; color: #6b7280;">æ­£åœ¨å¯¼å…¥æ•°æ®...</p>
        </div>
    </div>
</div>

<!-- æç¤ºæ¶ˆæ¯ -->
<div id="encouragement-toast" class="toast">
    <span id="encouragement-text"></span>
</div>

<!-- åŒæ­¥çŠ¶æ€ -->
<div id="sync-status" class="sync-status">
    <span id="sync-status-text">åŒæ­¥ä¸­...</span>
</div>

<script>
// Firebase é…ç½®
const firebaseConfig = {
    apiKey: "AIzaSyBPLuMktx7vBuqmh6KzIyRlNHK4yh4j5OY",
    authDomain: "words-43d1b.firebaseapp.com",
    databaseURL: "https://words-43d1b-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "words-43d1b",
    storageBucket: "words-43d1b.firebasestorage.app",
    messagingSenderId: "992209854334",
    appId: "1:992209854334:web:e862a34544b49a243e1d2f",
    measurementId: "G-982EDQG7X0"
};

// åº”ç”¨çŠ¶æ€
let database = null;
let firebaseAvailable = false;
let currentUser = null;
let wordsData = {};
let isOnline = navigator.onLine;
let useLocalMode = false;
let importData = null;
let currentView = 'card'; // é»˜è®¤å¡ç‰‡è§†å›¾
let reviewWords = [];
let currentReviewIndex = 0;
let reviewDate = null;

// åŠ è½½çŠ¶æ€ç®¡ç†
const loadingOverlay = document.getElementById('loading-overlay');
const loadingStatus = document.getElementById('loading-status');

function showLoading(message) {
    if (loadingStatus) {
        loadingStatus.textContent = message;
    }
}

function hideLoading() {
    if (loadingOverlay) {
        loadingOverlay.style.display = 'none';
    }
}

// Firebase SDK åŠ è½½å™¨
class FirebaseLoader {
    async loadFirebaseSDK() {
        showLoading('æ­£åœ¨åŠ è½½ Firebase SDK...');

        try {
            // è®¾ç½®è¶…æ—¶
            const timeoutPromise = new Promise((_, reject) => {
                setTimeout(() => reject(new Error('åŠ è½½è¶…æ—¶')), 10000);
            });

            // å°è¯•åŠ è½½ Firebase
            await Promise.race([
                this.loadScript('https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js'),
                timeoutPromise
            ]);

            await this.loadScript('https://www.gstatic.com/firebasejs/9.15.0/firebase-database-compat.js');
            await this.loadScript('https://www.gstatic.com/firebasejs/9.15.0/firebase-auth-compat.js');

            // ç­‰å¾…è„šæœ¬æ‰§è¡Œ
            await this.delay(1000);

            if (typeof firebase !== 'undefined') {
                showLoading('âœ… Firebase SDK åŠ è½½æˆåŠŸï¼');
                await this.delay(500);
                hideLoading();
                return true;
            } else {
                throw new Error('Firebase æœªæ­£ç¡®åŠ è½½');
            }
        } catch (error) {
            console.error('Firebase åŠ è½½å¤±è´¥:', error);
            showLoading('âš ï¸ Firebase åŠ è½½å¤±è´¥ï¼Œå°†ä½¿ç”¨æœ¬åœ°æ¨¡å¼');
            await this.delay(2000);
            hideLoading();
            return false;
        }
    }

    loadScript(src) {
        return new Promise((resolve, reject) => {
            const script = document.createElement('script');
            script.src = src;
            script.async = true;

            script.onload = resolve;
            script.onerror = reject;

            document.head.appendChild(script);
        });
    }

    delay(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
    }
}

// åˆå§‹åŒ– Firebase åŠ è½½å™¨
const firebaseLoader = new FirebaseLoader();

// é¡µé¢åŠ è½½å®Œæˆåå¼€å§‹åŠ è½½ Firebase
window.addEventListener('DOMContentLoaded', async () => {
    console.log('DOM åŠ è½½å®Œæˆï¼Œå¼€å§‹åˆå§‹åŒ–åº”ç”¨');
    
    // è®¾ç½®ä¸€ä¸ªæ€»è¶…æ—¶ï¼Œç¡®ä¿åº”ç”¨ä¸ä¼šä¸€ç›´å¡åœ¨åˆå§‹åŒ–çŠ¶æ€
    const initTimeout = setTimeout(() => {
        console.log('åˆå§‹åŒ–è¶…æ—¶ï¼Œå¼ºåˆ¶éšè—åŠ è½½ç•Œé¢');
        hideLoading();
        initializeApp(true); // å¼ºåˆ¶ä½¿ç”¨æœ¬åœ°æ¨¡å¼
    }, 15000); // 15ç§’è¶…æ—¶
    
    try {
        const firebaseLoaded = await firebaseLoader.loadFirebaseSDK();
        clearTimeout(initTimeout);
        console.log('åˆå§‹åŒ–åº”ç”¨ï¼ŒFirebase å¯ç”¨:', firebaseLoaded);
        initializeApp(!firebaseLoaded);
    } catch (error) {
        clearTimeout(initTimeout);
        console.error('åˆå§‹åŒ–è¿‡ç¨‹ä¸­å‡ºé”™:', error);
        hideLoading();
        initializeApp(true); // å‡ºé”™æ—¶ä½¿ç”¨æœ¬åœ°æ¨¡å¼
    }
});

function initializeApp(firebaseOnly = false) {
    // ç¡®ä¿åŠ è½½é®ç½©è¢«éšè—
    hideLoading();
    
    // åˆå§‹åŒ– Firebase
    if (!firebaseOnly && typeof firebase !== 'undefined') {
        try {
            firebase.initializeApp(firebaseConfig);
            database = firebase.database();
            firebaseAvailable = true;
            console.log('Firebase åˆå§‹åŒ–æˆåŠŸ');
        } catch (error) {
            console.error('Firebase åˆå§‹åŒ–å¤±è´¥:', error);
        }
    } else {
        console.log('Firebase ä¸å¯ç”¨ï¼Œå°†ä½¿ç”¨æœ¬åœ°æ¨¡å¼');
    }

    // ç¡®ä¿ç™»å½•ç•Œé¢å¯è§
    const loginContainer = document.getElementById('login-container');
    const appContainer = document.getElementById('app-container');
    
    if (loginContainer) {
        loginContainer.style.display = 'flex';
    }
    
    if (appContainer) {
        appContainer.style.display = 'none';
    }

    // å¦‚æœ Firebase ä¸å¯ç”¨ï¼Œé»˜è®¤ä½¿ç”¨æœ¬åœ°æ¨¡å¼
    if (!firebaseAvailable) {
        const useLocalCheckbox = document.getElementById('use-local');
        if (useLocalCheckbox) {
            useLocalCheckbox.checked = true;
            useLocalCheckbox.disabled = true;
        }
        useLocalMode = true;
    }

    // åˆå§‹åŒ–äº‹ä»¶ç›‘å¬å™¨
    initializeEventListeners();
}

function initializeEventListeners() {
    // ç™»å½•è¡¨å•
    const loginForm = document.getElementById('login-form');
    if (loginForm) {
        loginForm.addEventListener('submit', handleLogin);
    }

    // é€€å‡ºç™»å½•
    const logoutBtn = document.getElementById('logout-btn');
    if (logoutBtn) {
        logoutBtn.addEventListener('click', handleLogout);
    }

    // æ‰‹åŠ¨åŒæ­¥
    const syncBtn = document.getElementById('sync-btn');
    if (syncBtn) {
        syncBtn.addEventListener('click', handleSync);
    }

    // åŠŸèƒ½æŒ‰é’®
    const addWordBtn = document.getElementById('add-word-btn');
    if (addWordBtn) {
        addWordBtn.addEventListener('click', showAddWordModal);
    }

    const reviewBtn = document.getElementById('review-btn');
    if (reviewBtn) {
        reviewBtn.addEventListener('click', showReviewModal);
    }

    // å•è¯è¡¨å•
    const wordForm = document.getElementById('word-form');
    if (wordForm) {
        wordForm.addEventListener('submit', handleAddWord);
    }

    // ç¼–è¾‘å•è¯è¡¨å•
    const editWordForm = document.getElementById('edit-word-form');
    if (editWordForm) {
        editWordForm.addEventListener('submit', handleEditWord);
    }

    // å¯¼å…¥å¯¼å‡º
    const exportTriggerBtn = document.getElementById('export-trigger-btn');
    if (exportTriggerBtn) {
        exportTriggerBtn.addEventListener('click', showExportModal);
    }

    const importTriggerBtn = document.getElementById('import-trigger-btn');
    if (importTriggerBtn) {
        importTriggerBtn.addEventListener('click', showImportModal);
    }

    // æ¨¡æ€æ¡†å…³é—­
    const closeModalBtn = document.getElementById('close-modal-btn');
    if (closeModalBtn) {
        closeModalBtn.addEventListener('click', hideExportModal);
    }

    const closeImportModalBtn = document.getElementById('close-import-modal-btn');
    if (closeImportModalBtn) {
        closeImportModalBtn.addEventListener('click', hideImportModal);
    }

    const closeAddModalBtn = document.getElementById('close-add-modal-btn');
    if (closeAddModalBtn) {
        closeAddModalBtn.addEventListener('click', hideAddWordModal);
    }

    const closeEditModalBtn = document.getElementById('close-edit-modal-btn');
    if (closeEditModalBtn) {
        closeEditModalBtn.addEventListener('click', hideEditWordModal);
    }

    const closeReviewModalBtn = document.getElementById('close-review-modal-btn');
    if (closeReviewModalBtn) {
        closeReviewModalBtn.addEventListener('click', hideReviewModal);
    }

    const reviewCloseBtn = document.getElementById('review-close-btn');
    if (reviewCloseBtn) {
        reviewCloseBtn.addEventListener('click', hideReviewModal);
    }

    const cancelImportBtn = document.getElementById('cancel-import-btn');
    if (cancelImportBtn) {
        cancelImportBtn.addEventListener('click', hideImportModal);
    }

    const confirmImportBtn = document.getElementById('confirm-import-btn');
    if (confirmImportBtn) {
        confirmImportBtn.addEventListener('click', handleImport);
    }

    // è§†å›¾åˆ‡æ¢
    const cardViewBtn = document.getElementById('card-view-btn');
    if (cardViewBtn) {
        cardViewBtn.addEventListener('click', () => switchView('card'));
    }

    const listViewBtn = document.getElementById('list-view-btn');
    if (listViewBtn) {
        listViewBtn.addEventListener('click', () => switchView('list'));
    }

    // å¤ä¹ åŠŸèƒ½ - ä¿®æ”¹ä¸ºç‚¹å‡»é‡Šä¹‰åè‡ªåŠ¨è¿›å…¥ä¸‹ä¸€ä¸ªå•è¯
    const reviewCard = document.getElementById('review-card');
    if (reviewCard) {
        reviewCard.addEventListener('click', handleReviewCardClick);
    }

    // å¤ä¹ æŒ‰é’®
    const reviewBtnKnow = document.getElementById('review-btn-know');
    if (reviewBtnKnow) {
        reviewBtnKnow.addEventListener('click', () => markReviewWord(true));
    }

    const reviewBtnUnknown = document.getElementById('review-btn-unknown');
    if (reviewBtnUnknown) {
        reviewBtnUnknown.addEventListener('click', () => markReviewWord(false));
    }

    const reviewBtnNext = document.getElementById('review-btn-next');
    if (reviewBtnNext) {
        reviewBtnNext.addEventListener('click', nextReviewWord);
    }

    // æ–‡ä»¶æ‹–æ”¾
    initializeFileDrop();

    // ESC é”®å…³é—­æ¨¡æ€æ¡†
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
            hideExportModal();
            hideImportModal();
            hideAddWordModal();
            hideEditWordModal();
            hideReviewModal();
        }
    });

    // ç½‘ç»œçŠ¶æ€ç›‘å¬
    window.addEventListener('online', () => {
        isOnline = true;
        showSyncStatus('ç½‘ç»œå·²è¿æ¥', 2000);
    });

    window.addEventListener('offline', () => {
        isOnline = false;
        showSyncStatus('ç½‘ç»œå·²æ–­å¼€', 2000);
    });
}

// ç™»å½•å¤„ç†
async function handleLogin(e) {
    e.preventDefault();
    
    const username = document.getElementById('username').value.trim();
    const password = document.getElementById('password').value.trim();
    const useLocalCheckbox = document.getElementById('use-local');
    
    useLocalMode = useLocalCheckbox.checked || !firebaseAvailable;

    if (!username || !password) {
        alert('è¯·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ');
        return;
    }

    const hashedPassword = hashPassword(password);

    try {
        const loginText = document.getElementById('login-text');
        const loginSpinner = document.getElementById('login-spinner');
        const loginBtn = document.getElementById('login-btn');

        if (loginText) loginText.style.display = 'none';
        if (loginSpinner) loginSpinner.style.display = 'inline-block';
        if (loginBtn) loginBtn.disabled = true;

        showSyncStatus('ç™»å½•ä¸­...');
        console.log(`å°è¯•ç™»å½•ç”¨æˆ·: ${username}, ä½¿ç”¨æœ¬åœ°æ¨¡å¼: ${useLocalMode}`);

        if (useLocalMode) {
            // æœ¬åœ°å­˜å‚¨æ¨¡å¼
            currentUser = username;
            wordsData = JSON.parse(localStorage.getItem('words_' + username) || '{}');
            console.log('æœ¬åœ°å­˜å‚¨æ¨¡å¼ç™»å½•æˆåŠŸ');
            showApp();
        } else {
            // äº‘ç«¯æ¨¡å¼
            if (!database) {
                throw new Error('Firebase æœªåˆå§‹åŒ–');
            }

            // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å­˜åœ¨
            const userRef = database.ref('users/' + username);
            const snapshot = await userRef.once('value');

            if (snapshot.exists()) {
                // ç”¨æˆ·å­˜åœ¨ï¼ŒéªŒè¯å¯†ç 
                const userData = snapshot.val();
                if (userData.password === hashedPassword) {
                    currentUser = username;
                    await loadUserWords();
                    showApp();
                } else {
                    alert('å¯†ç é”™è¯¯');
                }
            } else {
                // æ–°ç”¨æˆ·ï¼Œåˆ›å»ºè´¦æˆ·
                await userRef.set({
                    password: hashedPassword,
                    createdAt: new Date().toISOString(),
                    lastLogin: new Date().toISOString()
                });
                currentUser = username;
                wordsData = {};
                showApp();
            }
        }
    } catch (error) {
        console.error('ç™»å½•é”™è¯¯:', error);

        // å¦‚æœäº‘ç«¯å¤±è´¥ï¼Œè‡ªåŠ¨åˆ‡æ¢åˆ°æœ¬åœ°æ¨¡å¼
        if (!useLocalMode) {
            const useLocalFallback = confirm(
                `äº‘ç«¯ç™»å½•å¤±è´¥: ${error.message}\n\næ˜¯å¦ä½¿ç”¨æœ¬åœ°å­˜å‚¨æ¨¡å¼ï¼Ÿ\nï¼ˆæ•°æ®å°†ä¿å­˜åœ¨æµè§ˆå™¨ä¸­ï¼Œæ— æ³•è·¨è®¾å¤‡åŒæ­¥ï¼‰`
            );

            if (useLocalFallback) {
                useLocalMode = true;
                const useLocalCheckbox = document.getElementById('use-local');
                if (useLocalCheckbox) {
                    useLocalCheckbox.checked = true;
                }
                currentUser = username;
                wordsData = JSON.parse(localStorage.getItem('words_' + username) || '{}');
                showApp();
            } else {
                alert('ç™»å½•å¤±è´¥ï¼Œè¯·é‡è¯•');
            }
        } else {
            alert('ç™»å½•å¤±è´¥: ' + error.message);
        }
    } finally {
        const loginText = document.getElementById('login-text');
        const loginSpinner = document.getElementById('login-spinner');
        const loginBtn = document.getElementById('login-btn');

        if (loginText) loginText.style.display = 'inline';
        if (loginSpinner) loginSpinner.style.display = 'none';
        if (loginBtn) loginBtn.disabled = false;
        showSyncStatus('');
    }
}

// é€€å‡ºç™»å½•
function handleLogout() {
    if (confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ')) {
        currentUser = null;
        wordsData = {};
        
        const loginContainer = document.getElementById('login-container');
        const appContainer = document.getElementById('app-container');
        const usernameInput = document.getElementById('username');
        const passwordInput = document.getElementById('password');
        const useLocalCheckbox = document.getElementById('use-local');
        
        if (loginContainer) loginContainer.style.display = 'flex';
        if (appContainer) appContainer.style.display = 'none';
        if (usernameInput) usernameInput.value = '';
        if (passwordInput) passwordInput.value = '';
        if (useLocalCheckbox) useLocalCheckbox.checked = false;
    }
}

// æ‰‹åŠ¨åŒæ­¥
async function handleSync() {
    if (useLocalMode || !firebaseAvailable) {
        showSyncStatus('æœ¬åœ°å­˜å‚¨æ¨¡å¼ï¼Œæ— éœ€åŒæ­¥', 2000);
        return;
    }

    if (!isOnline) {
        showSyncStatus('ç½‘ç»œæœªè¿æ¥', 2000);
        return;
    }
    await saveUserWords();
}

// æ˜¾ç¤ºä¸»åº”ç”¨
function showApp() {
    const loginContainer = document.getElementById('login-container');
    const appContainer = document.getElementById('app-container');
    const currentUserSpan = document.getElementById('current-user');
    
    if (loginContainer) loginContainer.style.display = 'none';
    if (appContainer) appContainer.style.display = 'block';
    if (currentUserSpan) {
        currentUserSpan.textContent = currentUser + (useLocalMode || !firebaseAvailable ? ' (æœ¬åœ°æ¨¡å¼)' : '');
    }
    renderWords();
}

// åŠ è½½ç”¨æˆ·æ•°æ®
async function loadUserWords() {
    if (!currentUser) return;

    if (useLocalMode || !firebaseAvailable) {
        wordsData = JSON.parse(localStorage.getItem('words_' + currentUser) || '{}');
        return;
    }

    try {
        showSyncStatus('åŠ è½½æ•°æ®...');
        const wordsRef = database.ref('words/' + currentUser);
        const snapshot = await wordsRef.once('value');
        wordsData = snapshot.val() || {};

        // æ›´æ–°æœ€åç™»å½•æ—¶é—´
        database.ref('users/' + currentUser + '/lastLogin').set(new Date().toISOString());
    } catch (error) {
        console.error('åŠ è½½æ•°æ®é”™è¯¯:', error);
        showSyncStatus('åŠ è½½æ•°æ®å¤±è´¥', 2000);
        wordsData = {};
    }
}

// ä¿å­˜ç”¨æˆ·æ•°æ®
async function saveUserWords() {
    if (!currentUser) return;

    if (useLocalMode || !firebaseAvailable) {
        localStorage.setItem('words_' + currentUser, JSON.stringify(wordsData));
        showSyncStatus('å·²ä¿å­˜åˆ°æœ¬åœ°', 1500);
        return;
    }

    try {
        const syncText = document.getElementById('sync-text');
        const syncSpinner = document.getElementById('sync-spinner');
        
        if (syncText) syncText.style.display = 'none';
        if (syncSpinner) syncSpinner.style.display = 'inline-block';
        showSyncStatus('ä¿å­˜ä¸­...');

        await database.ref('words/' + currentUser).set(wordsData);
        showSyncStatus('å·²åŒæ­¥åˆ°äº‘ç«¯', 1500);
    } catch (error) {
        console.error('ä¿å­˜æ•°æ®é”™è¯¯:', error);
        showSyncStatus('åŒæ­¥å¤±è´¥', 2000);
    } finally {
        const syncText = document.getElementById('sync-text');
        const syncSpinner = document.getElementById('sync-spinner');
        
        if (syncText) syncText.style.display = 'inline';
        if (syncSpinner) syncSpinner.style.display = 'none';
    }
}

// æ˜¾ç¤ºæ·»åŠ å•è¯æ¨¡æ€æ¡†
function showAddWordModal() {
    const modal = document.getElementById('add-word-modal');
    if (modal) {
        modal.classList.add('show');
        document.body.style.overflow = 'hidden';
        // èšç„¦åˆ°å•è¯è¾“å…¥æ¡†
        setTimeout(() => {
            const wordInput = document.getElementById('word-input');
            if (wordInput) wordInput.focus();
        }, 100);
    }
}

// éšè—æ·»åŠ å•è¯æ¨¡æ€æ¡†
function hideAddWordModal() {
    const modal = document.getElementById('add-word-modal');
    if (modal) {
        modal.classList.remove('show');
        document.body.style.overflow = '';
        // é‡ç½®è¡¨å•
        const wordForm = document.getElementById('word-form');
        if (wordForm) wordForm.reset();
    }
}

// æ˜¾ç¤ºç¼–è¾‘å•è¯æ¨¡æ€æ¡†
function showEditWordModal(date, id) {
    // æ‰¾åˆ°è¦ç¼–è¾‘çš„å•è¯
    const word = wordsData[date].find(w => w.id === id);
    if (!word) return;

    // å¡«å……è¡¨å•
    const editWordId = document.getElementById('edit-word-id');
    const editWordDate = document.getElementById('edit-word-date');
    const editWordInput = document.getElementById('edit-word-input');
    const editMeaningInput = document.getElementById('edit-meaning-input');
    const editSynonymInput = document.getElementById('edit-synonym-input');
    const editPhraseInput = document.getElementById('edit-phrase-input');
    const editMasteredCheckbox = document.getElementById('edit-mastered-checkbox');

    if (editWordId) editWordId.value = id;
    if (editWordDate) editWordDate.value = date;
    if (editWordInput) editWordInput.value = word.word || '';
    if (editMeaningInput) editMeaningInput.value = word.meaning || '';
    if (editSynonymInput) editSynonymInput.value = word.synonym || '';
    if (editPhraseInput) editPhraseInput.value = word.phrase || '';
    if (editMasteredCheckbox) editMasteredCheckbox.checked = word.mastered || false;

    // æ˜¾ç¤ºæ¨¡æ€æ¡†
    const modal = document.getElementById('edit-word-modal');
    if (modal) {
        modal.classList.add('show');
        document.body.style.overflow = 'hidden';
        // èšç„¦åˆ°å•è¯è¾“å…¥æ¡†
        setTimeout(() => {
            if (editWordInput) editWordInput.focus();
        }, 100);
    }
}

// éšè—ç¼–è¾‘å•è¯æ¨¡æ€æ¡†
function hideEditWordModal() {
    const modal = document.getElementById('edit-word-modal');
    if (modal) {
        modal.classList.remove('show');
        document.body.style.overflow = '';
        // é‡ç½®è¡¨å•
        const editWordForm = document.getElementById('edit-word-form');
        if (editWordForm) editWordForm.reset();
    }
}

// å¤„ç†ç¼–è¾‘å•è¯
async function handleEditWord(e) {
    e.preventDefault();
    
    const editWordId = document.getElementById('edit-word-id').value;
    const editWordDate = document.getElementById('edit-word-date').value;
    const editWordInput = document.getElementById('edit-word-input').value.trim();
    const editMeaningInput = document.getElementById('edit-meaning-input').value.trim();
    const editSynonymInput = document.getElementById('edit-synonym-input').value.trim();
    const editPhraseInput = document.getElementById('edit-phrase-input').value.trim();
    const editMasteredCheckbox = document.getElementById('edit-mastered-checkbox').checked;

    if (!editWordInput) return;

    // æ‰¾åˆ°è¦ç¼–è¾‘çš„å•è¯
    const wordIndex = wordsData[editWordDate].findIndex(w => w.id === parseInt(editWordId));
    if (wordIndex === -1) return;

    // æ›´æ–°å•è¯ä¿¡æ¯
    wordsData[editWordDate][wordIndex] = {
        ...wordsData[editWordDate][wordIndex],
        word: editWordInput,
        meaning: editMeaningInput,
        synonym: editSynonymInput,
        phrase: editPhraseInput,
        mastered: editMasteredCheckbox
    };

    // å…ˆæ›´æ–°UIï¼Œå†ä¿å­˜
    hideEditWordModal();
    renderWords();
    showSyncStatus('å•è¯å·²æ›´æ–°', 1500);

    // ä¿å­˜åˆ°äº‘ç«¯æˆ–æœ¬åœ°
    if (useLocalMode || !firebaseAvailable) {
        localStorage.setItem('words_' + currentUser, JSON.stringify(wordsData));
        showSyncStatus('å·²ä¿å­˜åˆ°æœ¬åœ°', 1500);
    } else {
        if (isOnline) {
            await saveUserWords();
        } else {
            showSyncStatus('ç¦»çº¿æ¨¡å¼ï¼Œæ•°æ®å°†åœ¨ç½‘ç»œæ¢å¤ååŒæ­¥', 3000);
        }
    }
}

// æ·»åŠ å•è¯
async function handleAddWord(e) {
    e.preventDefault();
    
    const wordInput = document.getElementById('word-input');
    const meaningInput = document.getElementById('meaning-input');
    const synonymInput = document.getElementById('synonym-input');
    const phraseInput = document.getElementById('phrase-input');
    
    const wordText = wordInput.value.trim();
    const meaningText = meaningInput.value.trim();
    const synonymText = synonymInput.value.trim();
    const phraseText = phraseInput.value.trim();

    if (!wordText) return;

    const today = new Date().toISOString().split('T')[0];

    if (!wordsData[today]) {
        wordsData[today] = [];
    }

    const newWord = {
        id: Date.now(),
        word: wordText,
        meaning: meaningText,
        synonym: synonymText,
        phrase: phraseText,
        mastered: false
    };

    wordsData[today].push(newWord);

    // å…ˆæ›´æ–°UIï¼Œå†ä¿å­˜
    hideAddWordModal();
    renderWords();
    showRandomEncouragement();

    // ä¿å­˜åˆ°äº‘ç«¯æˆ–æœ¬åœ°
    if (useLocalMode || !firebaseAvailable) {
        localStorage.setItem('words_' + currentUser, JSON.stringify(wordsData));
        showSyncStatus('å·²ä¿å­˜åˆ°æœ¬åœ°', 1500);
    } else {
        if (isOnline) {
            await saveUserWords();
        } else {
            showSyncStatus('ç¦»çº¿æ¨¡å¼ï¼Œæ•°æ®å°†åœ¨ç½‘ç»œæ¢å¤ååŒæ­¥', 3000);
        }
    }
}

// æ˜¾ç¤ºå¤ä¹ æ¨¡æ€æ¡†
function showReviewModal() {
    const modal = document.getElementById('review-modal');
    if (modal) {
        modal.classList.add('show');
        document.body.style.overflow = 'hidden';
        renderReviewDateOptions();
    }
}

// éšè—å¤ä¹ æ¨¡æ€æ¡†
function hideReviewModal() {
    const modal = document.getElementById('review-modal');
    if (modal) {
        modal.classList.remove('show');
        document.body.style.overflow = '';
        // é‡ç½®å¤ä¹ çŠ¶æ€
        reviewWords = [];
        currentReviewIndex = 0;
        reviewDate = null;
        
        // éšè—å¤ä¹ ç•Œé¢ï¼Œæ˜¾ç¤ºæ—¥æœŸé€‰æ‹©
        const reviewDateOptions = document.getElementById('review-date-options');
        const reviewContainer = document.getElementById('review-container');
        const reviewComplete = document.getElementById('review-complete');
        
        if (reviewDateOptions) reviewDateOptions.style.display = 'block';
        if (reviewContainer) reviewContainer.style.display = 'none';
        if (reviewComplete) reviewComplete.style.display = 'none';
    }
}

// æ¸²æŸ“å¤ä¹ æ—¥æœŸé€‰é¡¹
function renderReviewDateOptions() {
    const reviewDateOptions = document.getElementById('review-date-options');
    if (!reviewDateOptions) return;
    
    const sortedDates = Object.keys(wordsData).sort((a, b) => new Date(b) - new Date(a));
    
    if (sortedDates.length === 0) {
        reviewDateOptions.innerHTML = '<p style="text-align: center; color: #6b7280; padding: 1rem;">æ²¡æœ‰å¯å¤ä¹ çš„å•è¯ã€‚</p>';
        return;
    }
    
    let html = '<div class="review-date-selector">';
    
    // æ·»åŠ "å…¨éƒ¨å•è¯"é€‰é¡¹
    let totalWords = 0;
    sortedDates.forEach(date => {
        totalWords += wordsData[date].length;
    });
    
    html += `
        <div class="review-date-option" data-date="all">
            <div class="review-date-option-icon">ğŸ“š</div>
            <div class="review-date-option-text">å…¨éƒ¨å•è¯</div>
            <div class="review-date-option-count">${totalWords} ä¸ªå•è¯</div>
        </div>
    `;
    
    // æ·»åŠ "æœªæŒæ¡å•è¯"é€‰é¡¹
    let unmasteredWords = 0;
    sortedDates.forEach(date => {
        wordsData[date].forEach(word => {
            if (!word.mastered) unmasteredWords++;
        });
    });
    
    if (unmasteredWords > 0) {
        html += `
            <div class="review-date-option" data-date="unmastered">
                <div class="review-date-option-icon">ğŸ“–</div>
                <div class="review-date-option-text">æœªæŒæ¡å•è¯</div>
                <div class="review-date-option-count">${unmasteredWords} ä¸ªå•è¯</div>
            </div>
        `;
    }
    
    // æ·»åŠ æ—¥æœŸé€‰é¡¹
    sortedDates.forEach(dateStr => {
        const dayWords = wordsData[dateStr];
        const dateObj = new Date(dateStr + 'T00:00:00');
        const formattedDate = dateObj.toLocaleDateString('zh-CN', { month: 'short', day: 'numeric' });
        
        html += `
            <div class="review-date-option" data-date="${dateStr}">
                <div class="review-date-option-icon">ğŸ“…</div>
                <div class="review-date-option-text">${formattedDate}</div>
                <div class="review-date-option-count">${dayWords.length} ä¸ªå•è¯</div>
            </div>
        `;
    });
    
    html += '</div>';
    reviewDateOptions.innerHTML = html;
    
    // æ·»åŠ ç‚¹å‡»äº‹ä»¶
    const dateOptions = reviewDateOptions.querySelectorAll('.review-date-option');
    dateOptions.forEach(option => {
        option.addEventListener('click', () => {
            // ç§»é™¤å…¶ä»–é€‰é¡¹çš„é€‰ä¸­çŠ¶æ€
            dateOptions.forEach(opt => opt.classList.remove('selected'));
            // æ·»åŠ å½“å‰é€‰é¡¹çš„é€‰ä¸­çŠ¶æ€
            option.classList.add('selected');
            
            const selectedDate = option.dataset.date;
            startReview(selectedDate);
        });
    });
}

// å¼€å§‹å¤ä¹ 
function startReview(date) {
    reviewDate = date;
    reviewWords = [];
    
    if (date === 'all') {
        // å¤ä¹ æ‰€æœ‰å•è¯
        for (const dateStr in wordsData) {
            wordsData[dateStr].forEach(word => {
                reviewWords.push({...word, date: dateStr});
            });
        }
    } else if (date === 'unmastered') {
        // å¤ä¹ æœªæŒæ¡çš„å•è¯
        for (const dateStr in wordsData) {
            wordsData[dateStr].forEach(word => {
                if (!word.mastered) {
                    reviewWords.push({...word, date: dateStr});
                }
            });
        }
    } else {
        // å¤ä¹ æŒ‡å®šæ—¥æœŸçš„å•è¯
        if (wordsData[date]) {
            wordsData[date].forEach(word => {
                reviewWords.push({...word, date: date});
            });
        }
    }
    
    // éšæœºæ‰“ä¹±å•è¯é¡ºåº
    reviewWords.sort(() => Math.random() - 0.5);
    
    if (reviewWords.length === 0) {
        alert('æ²¡æœ‰å¯å¤ä¹ çš„å•è¯');
        return;
    }
    
    // éšè—æ—¥æœŸé€‰æ‹©ï¼Œæ˜¾ç¤ºå¤ä¹ ç•Œé¢
    const reviewDateOptions = document.getElementById('review-date-options');
    const reviewContainer = document.getElementById('review-container');
    
    if (reviewDateOptions) reviewDateOptions.style.display = 'none';
    if (reviewContainer) reviewContainer.style.display = 'block';
    
    currentReviewIndex = 0;
    showReviewWord();
}

// æ˜¾ç¤ºå¤ä¹ å•è¯
function showReviewWord() {
    if (currentReviewIndex >= reviewWords.length) {
        showReviewComplete();
        return;
    }
    
    const word = reviewWords[currentReviewIndex];
    const reviewWord = document.getElementById('review-word');
    const reviewMeaningContent = document.getElementById('review-meaning-content');
    const reviewSynonymContent = document.getElementById('review-synonym-content');
    const reviewPhraseContent = document.getElementById('review-phrase-content');
    const reviewCard = document.getElementById('review-card');
    
    // æ›´æ–°è¿›åº¦
    updateReviewProgress();
    
    // æ˜¾ç¤ºå•è¯
    if (reviewWord) reviewWord.textContent = word.word;
    if (reviewMeaningContent) reviewMeaningContent.textContent = word.meaning || '';
    if (reviewSynonymContent) reviewSynonymContent.textContent = word.synonym || '';
    if (reviewPhraseContent) reviewPhraseContent.textContent = word.phrase || '';
    
    // é‡ç½®å¡ç‰‡çŠ¶æ€
    if (reviewCard) reviewCard.classList.remove('flipped');
}

// å¤„ç†å¤ä¹ å¡ç‰‡ç‚¹å‡»
function handleReviewCardClick() {
    const reviewCard = document.getElementById('review-card');
    
    if (!reviewCard) return;
    
    // å¦‚æœå¡ç‰‡æœªç¿»è½¬ï¼Œåˆ™ç¿»è½¬å¡ç‰‡
    if (!reviewCard.classList.contains('flipped')) {
        reviewCard.classList.add('flipped');
        return;
    }
    
    // å¦‚æœå¡ç‰‡å·²ç¿»è½¬ï¼Œåˆ™è¿›å…¥ä¸‹ä¸€ä¸ªå•è¯
    nextReviewWord();
}

// æ ‡è®°å¤ä¹ å•è¯
function markReviewWord(known) {
    if (currentReviewIndex >= reviewWords.length) return;
    
    const word = reviewWords[currentReviewIndex];
    
    // æ›´æ–°å•è¯æŒæ¡çŠ¶æ€
    if (wordsData[word.date]) {
        const wordIndex = wordsData[word.date].findIndex(w => w.id === word.id);
        if (wordIndex !== -1) {
            wordsData[word.date][wordIndex].mastered = known;
        }
    }
    
    // è¿›å…¥ä¸‹ä¸€ä¸ªå•è¯
    nextReviewWord();
}

// ä¸‹ä¸€ä¸ªå¤ä¹ å•è¯
function nextReviewWord() {
    currentReviewIndex++;
    showReviewWord();
}

// æ›´æ–°å¤ä¹ è¿›åº¦
function updateReviewProgress() {
    const progressFill = document.getElementById('review-progress-fill');
    const progressText = document.getElementById('review-progress-text');
    const progressPercentage = document.getElementById('review-progress-percentage');
    
    if (progressFill) {
        const percentage = ((currentReviewIndex + 1) / reviewWords.length) * 100;
        progressFill.style.width = `${percentage}%`;
    }
    
    if (progressText) {
        progressText.textContent = `${currentReviewIndex + 1} / ${reviewWords.length}`;
    }
    
    if (progressPercentage) {
        const percentage = Math.round(((currentReviewIndex + 1) / reviewWords.length) * 100);
        progressPercentage.textContent = `${percentage}%`;
    }
}

// æ˜¾ç¤ºå¤ä¹ å®Œæˆ
function showReviewComplete() {
    const reviewContainer = document.getElementById('review-container');
    const reviewComplete = document.getElementById('review-complete');
    
    if (reviewContainer) reviewContainer.style.display = 'none';
    if (reviewComplete) reviewComplete.style.display = 'block';
    
    // æ›´æ–°ç»Ÿè®¡
    renderWords();
}

// åˆ‡æ¢è§†å›¾
function switchView(view) {
    currentView = view;
    
    const cardViewBtn = document.getElementById('card-view-btn');
    const listViewBtn = document.getElementById('list-view-btn');
    
    if (view === 'card') {
        cardViewBtn.classList.add('active');
        listViewBtn.classList.remove('active');
    } else {
        cardViewBtn.classList.remove('active');
        listViewBtn.classList.add('active');
    }
    
    renderWords();
}

// æ¸²æŸ“å•è¯åˆ—è¡¨
function renderWords() {
    const wordListContainer = document.getElementById('word-list-container');
    if (!wordListContainer) return;
    
    wordListContainer.innerHTML = '';
    const sortedDates = Object.keys(wordsData).sort((a, b) => new Date(b) - new Date(a));

    if (sortedDates.length === 0) {
        wordListContainer.innerHTML = `
            <div class="empty-state">
                <div class="empty-state-icon">ğŸ“š</div>
                <div class="empty-state-text">è¿˜æ²¡æœ‰è®°å½•ä»»ä½•å•è¯</div>
                <div class="empty-state-subtext">ç‚¹å‡»"æ·»åŠ å•è¯"å¼€å§‹è®°å½•å§ï¼</div>
            </div>
        `;
        updateStats();
        return;
    }

    if (currentView === 'card') {
        renderCardView(sortedDates);
    } else {
        renderListView(sortedDates);
    }
    
    updateStats();
}

// æ¸²æŸ“å¡ç‰‡è§†å›¾
function renderCardView(sortedDates) {
    const wordListContainer = document.getElementById('word-list-container');
    
    sortedDates.forEach(dateStr => {
        // å¯¹æ¯ä¸€å¤©çš„å•è¯æŒ‰ç…§idå€’åºæ’åˆ—ï¼Œè¿™æ ·æœ€æ–°æ·»åŠ çš„å•è¯ä¼šæ˜¾ç¤ºåœ¨æœ€ä¸Šé¢
        const dayWords = [...wordsData[dateStr]].sort((a, b) => b.id - a.id);
        const dateObj = new Date(dateStr + 'T00:00:00');
        const formattedDate = dateObj.toLocaleDateString('zh-CN', { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' });

        // æ·»åŠ æ—¥æœŸæ ‡é¢˜
        const dateTitle = document.createElement('h3');
        dateTitle.className = 'date-group-title';
        dateTitle.textContent = `${formattedDate} (${dayWords.length} ä¸ªå•è¯)`;
        wordListContainer.appendChild(dateTitle);

        // åˆ›å»ºå¡ç‰‡å®¹å™¨
        const cardsContainer = document.createElement('div');
        cardsContainer.className = 'word-cards-container';

        dayWords.forEach(word => {
            const wordCard = createWordCard(word, dateStr);
            cardsContainer.appendChild(wordCard);
        });

        wordListContainer.appendChild(cardsContainer);
    });
}

// æ¸²æŸ“åˆ—è¡¨è§†å›¾
function renderListView(sortedDates) {
    const wordListContainer = document.getElementById('word-list-container');
    
    sortedDates.forEach(dateStr => {
        // å¯¹æ¯ä¸€å¤©çš„å•è¯æŒ‰ç…§idå€’åºæ’åˆ—ï¼Œè¿™æ ·æœ€æ–°æ·»åŠ çš„å•è¯ä¼šæ˜¾ç¤ºåœ¨æœ€ä¸Šé¢
        const dayWords = [...wordsData[dateStr]].sort((a, b) => b.id - a.id);
        const dateObj = new Date(dateStr + 'T00:00:00');
        const formattedDate = dateObj.toLocaleDateString('zh-CN', { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' });

        const daySection = document.createElement('div');
        daySection.className = 'word-list-container';

        const dateHeader = document.createElement('div');
        dateHeader.className = 'word-list-header';
        
        const dateTitle = document.createElement('h3');
        dateTitle.className = 'word-list-title';
        dateTitle.textContent = formattedDate;
        
        const dateCount = document.createElement('span');
        dateCount.className = 'word-list-count';
        dateCount.textContent = `${dayWords.length} ä¸ªå•è¯`;
        
        dateHeader.appendChild(dateTitle);
        dateHeader.appendChild(dateCount);
        daySection.appendChild(dateHeader);

        const wordListContent = document.createElement('div');
        wordListContent.className = 'word-list-content';

        dayWords.forEach(word => {
            const wordItem = createWordListItem(word, dateStr);
            wordListContent.appendChild(wordItem);
        });

        daySection.appendChild(wordListContent);
        wordListContainer.appendChild(daySection);
    });
}

// åˆ›å»ºå•è¯å¡ç‰‡
function createWordCard(word, dateStr) {
    const wordCard = document.createElement('div');
    wordCard.className = `word-card ${word.mastered ? 'word-mastered' : ''}`;
    wordCard.dataset.date = dateStr;
    wordCard.dataset.id = word.id;

    const cardInner = document.createElement('div');
    cardInner.className = 'word-card-inner';

    // å¡ç‰‡æ­£é¢
    const cardFront = document.createElement('div');
    cardFront.className = 'word-card-front';

    const cardActions = document.createElement('div');
    cardActions.className = 'word-card-actions';

    const editBtn = document.createElement('button');
    editBtn.className = 'word-card-btn';
    editBtn.innerHTML = 'âœï¸';
    editBtn.title = 'ç¼–è¾‘';
    editBtn.onclick = (e) => {
        e.stopPropagation();
        showEditWordModal(dateStr, word.id);
    };

    const masterBtn = document.createElement('button');
    masterBtn.className = 'word-card-btn';
    masterBtn.innerHTML = word.mastered ? 'â†©ï¸' : 'âœ…';
    masterBtn.title = word.mastered ? 'æ ‡è®°ä¸ºæœªæŒæ¡' : 'æ ‡è®°ä¸ºå·²æŒæ¡';
    masterBtn.onclick = (e) => {
        e.stopPropagation();
        toggleMaster(dateStr, word.id);
    };

    const deleteBtn = document.createElement('button');
    deleteBtn.className = 'word-card-btn';
    deleteBtn.innerHTML = 'ğŸ—‘ï¸';
    deleteBtn.title = 'åˆ é™¤';
    deleteBtn.onclick = (e) => {
        e.stopPropagation();
        deleteWord(dateStr, word.id);
    };

    cardActions.appendChild(editBtn);
    cardActions.appendChild(masterBtn);
    cardActions.appendChild(deleteBtn);

    const wordTitle = document.createElement('div');
    wordTitle.className = 'word-title';
    wordTitle.textContent = word.word;

    const wordDate = document.createElement('div');
    wordDate.className = 'word-date';
    wordDate.textContent = dateStr;

    cardFront.appendChild(cardActions);
    cardFront.appendChild(wordTitle);
    cardFront.appendChild(wordDate);

    // å¡ç‰‡èƒŒé¢
    const cardBack = document.createElement('div');
    cardBack.className = 'word-card-back';

    const backActions = document.createElement('div');
    backActions.className = 'word-card-actions';

    const backEditBtn = document.createElement('button');
    backEditBtn.className = 'word-card-btn';
    backEditBtn.innerHTML = 'âœï¸';
    backEditBtn.title = 'ç¼–è¾‘';
    backEditBtn.onclick = (e) => {
        e.stopPropagation();
        showEditWordModal(dateStr, word.id);
    };

    const backMasterBtn = document.createElement('button');
    backMasterBtn.className = 'word-card-btn';
    backMasterBtn.innerHTML = word.mastered ? 'â†©ï¸' : 'âœ…';
    backMasterBtn.title = word.mastered ? 'æ ‡è®°ä¸ºæœªæŒæ¡' : 'æ ‡è®°ä¸ºå·²æŒæ¡';
    backMasterBtn.onclick = (e) => {
        e.stopPropagation();
        toggleMaster(dateStr, word.id);
    };

    const backDeleteBtn = document.createElement('button');
    backDeleteBtn.className = 'word-card-btn';
    backDeleteBtn.innerHTML = 'ğŸ—‘ï¸';
    backDeleteBtn.title = 'åˆ é™¤';
    backDeleteBtn.onclick = (e) => {
        e.stopPropagation();
        deleteWord(dateStr, word.id);
    };

    backActions.appendChild(backEditBtn);
    backActions.appendChild(backMasterBtn);
    backActions.appendChild(backDeleteBtn);

    cardBack.appendChild(backActions);

    if (word.meaning) {
        const meaningDiv = document.createElement('div');
        meaningDiv.className = 'word-detail';
        meaningDiv.innerHTML = `
            <div class="word-detail-title">é‡Šä¹‰</div>
            <div class="word-detail-content">${word.meaning}</div>
        `;
        cardBack.appendChild(meaningDiv);
    }

    if (word.synonym) {
        const synonymDiv = document.createElement('div');
        synonymDiv.className = 'word-detail';
        synonymDiv.innerHTML = `
            <div class="word-detail-title">åŒä¹‰è¯</div>
            <div class="word-detail-content">${word.synonym}</div>
        `;
        cardBack.appendChild(synonymDiv);
    }

    if (word.phrase) {
        const phraseDiv = document.createElement('div');
        phraseDiv.className = 'word-detail';
        phraseDiv.innerHTML = `
            <div class="word-detail-title">è¯ç»„</div>
            <div class="word-detail-content">${word.phrase}</div>
        `;
        cardBack.appendChild(phraseDiv);
    }

    // æ·»åŠ ç‚¹å‡»ç¿»è½¬åŠŸèƒ½
    cardFront.addEventListener('click', () => {
        wordCard.classList.toggle('flipped');
    });

    cardBack.addEventListener('click', () => {
        wordCard.classList.toggle('flipped');
    });

    cardInner.appendChild(cardFront);
    cardInner.appendChild(cardBack);
    wordCard.appendChild(cardInner);

    return wordCard;
}

// åˆ›å»ºå•è¯åˆ—è¡¨é¡¹ï¼ˆåˆ—è¡¨è§†å›¾ï¼‰
function createWordListItem(word, dateStr) {
    const wordItem = document.createElement('div');
    wordItem.className = `word-item ${word.mastered ? 'mastered' : ''}`;
    wordItem.dataset.date = dateStr;
    wordItem.dataset.id = word.id;

    const wordContent = document.createElement('div');
    wordContent.className = 'word-item-content';

    const wordTitle = document.createElement('div');
    wordTitle.className = 'word-item-title';
    wordTitle.textContent = word.word;

    const wordDetails = document.createElement('div');
    wordDetails.className = 'word-item-details';

    if (word.meaning) {
        const meaningDetail = document.createElement('div');
        meaningDetail.className = 'word-item-detail';
        meaningDetail.innerHTML = `<span class="word-item-detail-title">é‡Šä¹‰:</span> ${word.meaning}`;
        wordDetails.appendChild(meaningDetail);
    }

    if (word.synonym) {
        const synonymDetail = document.createElement('div');
        synonymDetail.className = 'word-item-detail';
        synonymDetail.innerHTML = `<span class="word-item-detail-title">åŒä¹‰è¯:</span> ${word.synonym}`;
        wordDetails.appendChild(synonymDetail);
    }

    if (word.phrase) {
        const phraseDetail = document.createElement('div');
        phraseDetail.className = 'word-item-detail';
        phraseDetail.innerHTML = `<span class="word-item-detail-title">è¯ç»„:</span> ${word.phrase}`;
        wordDetails.appendChild(phraseDetail);
    }

    wordContent.appendChild(wordTitle);
    wordContent.appendChild(wordDetails);

    const wordActions = document.createElement('div');
    wordActions.className = 'word-item-actions';

    const editBtn = document.createElement('button');
    editBtn.className = 'word-item-btn word-item-btn-edit';
    editBtn.innerHTML = 'âœï¸';
    editBtn.title = 'ç¼–è¾‘';
    editBtn.onclick = () => showEditWordModal(dateStr, word.id);

    const masterBtn = document.createElement('button');
    masterBtn.className = `word-item-btn word-item-btn-master ${word.mastered ? 'mastered' : ''}`;
    masterBtn.innerHTML = word.mastered ? 'â†©ï¸' : 'âœ…';
    masterBtn.title = word.mastered ? 'æ ‡è®°ä¸ºæœªæŒæ¡' : 'æ ‡è®°ä¸ºå·²æŒæ¡';
    masterBtn.onclick = () => toggleMaster(dateStr, word.id);

    const deleteBtn = document.createElement('button');
    deleteBtn.className = 'word-item-btn word-item-btn-delete';
    deleteBtn.innerHTML = 'ğŸ—‘ï¸';
    deleteBtn.title = 'åˆ é™¤';
    deleteBtn.onclick = () => deleteWord(dateStr, word.id);

    wordActions.appendChild(editBtn);
    wordActions.appendChild(masterBtn);
    wordActions.appendChild(deleteBtn);

    wordItem.appendChild(wordContent);
    wordItem.appendChild(wordActions);

    return wordItem;
}

// æ›´æ–°ç»Ÿè®¡
function updateStats() {
    let totalWords = 0;
    let masteredWords = 0;
    const today = new Date().toISOString().split('T')[0];
    let todayWordsCount = 0;

    const dates = Object.keys(wordsData);
    dates.forEach(date => {
        const dayWords = wordsData[date];
        totalWords += dayWords.length;
        dayWords.forEach(w => { if (w.mastered) masteredWords++; });
        if (date === today) {
            todayWordsCount = dayWords.length;
        }
    });

    const totalWordsEl = document.getElementById('total-words');
    const studyDaysEl = document.getElementById('study-days');
    const todayWordsEl = document.getElementById('today-words');
    const masteredWordsEl = document.getElementById('mastered-words');

    if (totalWordsEl) totalWordsEl.textContent = totalWords;
    if (studyDaysEl) studyDaysEl.textContent = dates.length;
    if (todayWordsEl) todayWordsEl.textContent = todayWordsCount;
    if (masteredWordsEl) masteredWordsEl.textContent = masteredWords;
}

// åˆ é™¤å•è¯
async function deleteWord(date, id) {
    const idStr = String(id);
    if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªå•è¯å—ï¼Ÿ')) {
        wordsData[date] = wordsData[date].filter(w => String(w.id) !== idStr);
        if (wordsData[date].length === 0) {
            delete wordsData[date];
        }
        renderWords();

        if (useLocalMode || !firebaseAvailable) {
            localStorage.setItem('words_' + currentUser, JSON.stringify(wordsData));
            showSyncStatus('å·²ä¿å­˜åˆ°æœ¬åœ°', 1500);
        } else {
            if (isOnline) {
                await saveUserWords();
            } else {
                showSyncStatus('ç¦»çº¿æ¨¡å¼ï¼Œæ•°æ®å°†åœ¨ç½‘ç»œæ¢å¤ååŒæ­¥', 3000);
            }
        }
    }
}

// åˆ‡æ¢æŒæ¡çŠ¶æ€
async function toggleMaster(date, id) {
    const idStr = String(id);
    const word = wordsData[date].find(w => String(w.id) === idStr);
    if (word) {
        word.mastered = !word.mastered;
        renderWords();

        if (useLocalMode || !firebaseAvailable) {
            localStorage.setItem('words_' + currentUser, JSON.stringify(wordsData));
            showSyncStatus('å·²ä¿å­˜åˆ°æœ¬åœ°', 1500);
        } else {
            if (isOnline) {
                await saveUserWords();
            } else {
                showSyncStatus('ç¦»çº¿æ¨¡å¼ï¼Œæ•°æ®å°†åœ¨ç½‘ç»œæ¢å¤ååŒæ­¥', 3000);
            }
        }
    }
}

// æ˜¾ç¤ºéšæœºé¼“åŠ±
function showRandomEncouragement() {
    const encouragements = [
        "å¤ªæ£’äº†ï¼åˆæŒæ¡ä¸€ä¸ªæ–°å•è¯ï¼",
        "åšæŒå°±æ˜¯èƒœåˆ©ï¼",
        "ä½ çš„è¯æ±‡é‡æ­£åœ¨ç¨³æ­¥å¢é•¿ï¼",
        "Excellent! Keep it up!",
        "çŸ¥è¯†å°±æ˜¯åŠ›é‡ï¼Œä½ æ­£åœ¨å˜å¼ºï¼",
        "ä»Šå¤©çš„ä½ æ¯”æ˜¨å¤©æ›´åšå­¦äº†ï¼",
        "Amazing! æ¯ä¸€ä¸ªå•è¯éƒ½æ˜¯ä¸€å—åŸºçŸ³ã€‚",
        "æŒä¹‹ä»¥æ’ï¼Œç»ˆå°†å¤§æˆï¼",
        "ä½ çš„åŠªåŠ›ï¼Œæ—¶é—´çœ‹å¾—è§ï¼",
        "åˆå‘ç›®æ ‡è¿ˆè¿›äº†ä¸€æ­¥ï¼"
];

const toast = document.getElementById('encouragement-toast');
const encouragementText = document.getElementById('encouragement-text');

if (toast && encouragementText) {
const randomIndex = Math.floor(Math.random() * encouragements.length);
const message = encouragements[randomIndex];
encouragementText.textContent = message;

toast.classList.add('show');

setTimeout(() => {
toast.classList.remove('show');
}, 3000);
}
}

// æ˜¾ç¤ºåŒæ­¥çŠ¶æ€
function showSyncStatus(message, duration = 2000) {
const syncStatus = document.getElementById('sync-status');
const syncStatusText = document.getElementById('sync-status-text');

if (syncStatus && syncStatusText) {
syncStatusText.textContent = message;
syncStatus.classList.add('show');
setTimeout(() => {
syncStatus.classList.remove('show');
}, duration);
}
}

// å¯†ç å“ˆå¸Œ
function hashPassword(password) {
let hash = 0;
for (let i = 0; i < password.length; i++) {
const char = password.charCodeAt(i);
hash = ((hash << 5) - hash) + char;
hash = hash & hash;
}
return hash.toString();
}

// å¯¼å‡ºç›¸å…³å‡½æ•°
function showExportModal() {
const modal = document.getElementById('export-modal');
const exportOptions = document.getElementById('export-options');

if (!modal || !exportOptions) return;

const dates = Object.keys(wordsData).sort((a, b) => new Date(b) - new Date(a));
exportOptions.innerHTML = '';

if (dates.length === 0) {
exportOptions.innerHTML = '<p style="text-align: center; color: #6b7280; padding: 1rem;">æ²¡æœ‰å¯å¯¼å‡ºçš„æ•°æ®ã€‚</p>';
} else {
const exportAllBtn = document.createElement('button');
exportAllBtn.textContent = 'ğŸ“¦ å¯¼å‡ºå…¨éƒ¨æ•°æ®';
exportAllBtn.className = 'btn btn-secondary';
exportAllBtn.style.cssText = 'width: 100%; margin-bottom: 0.5rem; justify-content: flex-start;';
exportAllBtn.onclick = exportAllData;
exportOptions.appendChild(exportAllBtn);

dates.forEach(dateStr => {
const dayWords = wordsData[dateStr];
const dateObj = new Date(dateStr + 'T00:00:00');
const formattedDate = dateObj.toLocaleDateString('zh-CN', { year: 'numeric', month: 'long', day: 'numeric' });

const dateBtn = document.createElement('button');
dateBtn.textContent = `${formattedDate} (${dayWords.length} ä¸ªå•è¯)`;
dateBtn.className = 'btn';
dateBtn.style.cssText = 'width: 100%; margin-bottom: 0.5rem; justify-content: flex-start; background-color: #f3f4f6; color: #374151;';
dateBtn.onclick = () => exportDataForDate(dateStr, formattedDate);
exportOptions.appendChild(dateBtn);
});
}

modal.classList.add('show');
document.body.style.overflow = 'hidden';
}

function hideExportModal() {
const modal = document.getElementById('export-modal');
if (modal) {
modal.classList.remove('show');
document.body.style.overflow = '';
}
}

function exportDataForDate(dateStr, formattedDate) {
const wordsForDate = wordsData[dateStr] || [];
const allWords = [];

wordsForDate.forEach(word => {
allWords.push({
'æ—¥æœŸ': dateStr,
'å•è¯': word.word,
'é‡Šä¹‰': word.meaning || '',
'åŒä¹‰è¯': word.synonym || '',
'è¯ç»„': word.phrase || '',
'æŒæ¡çŠ¶æ€': word.mastered ? 'å·²æŒæ¡' : 'å­¦ä¹ ä¸­'
});
});

if (allWords.length === 0) {
alert('è¯¥æ—¥æœŸæ²¡æœ‰æ•°æ®å¯ä»¥å¯¼å‡ºï¼');
return;
}

// åˆ›å»ºå¹¶ä¸‹è½½Excelæ–‡ä»¶
createAndDownloadExcel(allWords, `å•è¯è®°å½•_${dateStr}.xlsx`);
hideExportModal();
}

function exportAllData() {
const allWords = [];

for (const date in wordsData) {
wordsData[date].forEach(word => {
allWords.push({
'æ—¥æœŸ': date,
'å•è¯': word.word,
'é‡Šä¹‰': word.meaning || '',
'åŒä¹‰è¯': word.synonym || '',
'è¯ç»„': word.phrase || '',
'æŒæ¡çŠ¶æ€': word.mastered ? 'å·²æŒæ¡' : 'å­¦ä¹ ä¸­'
});
});
}

if (allWords.length === 0) {
alert('æ²¡æœ‰æ•°æ®å¯ä»¥å¯¼å‡ºï¼');
return;
}

const today = new Date().toISOString().split('T')[0];
createAndDownloadExcel(allWords, `æˆ‘çš„å•è¯è®°å½•_å…¨éƒ¨_${today}.xlsx`);
hideExportModal();
}

// å¯¼å…¥ç›¸å…³å‡½æ•°
function showImportModal() {
const modal = document.getElementById('import-modal');
if (modal) {
modal.classList.add('show');
document.body.style.overflow = 'hidden';
resetImportModal();
}
}

function hideImportModal() {
const modal = document.getElementById('import-modal');
if (modal) {
modal.classList.remove('show');
document.body.style.overflow = '';
resetImportModal();
}
}

function resetImportModal() {
const importFileInput = document.getElementById('import-file-input');
const importPreview = document.getElementById('import-preview');
const importStatus = document.getElementById('import-status');
const importError = document.getElementById('import-error');
const previewTable = document.getElementById('preview-table');

if (importFileInput) importFileInput.value = '';
if (importPreview) importPreview.style.display = 'none';
if (importStatus) importStatus.style.display = 'none';
if (importError) importError.classList.remove('show');
if (previewTable) previewTable.innerHTML = '';
importData = null;
}

function initializeFileDrop() {
const fileDropZone = document.getElementById('file-drop-zone');
const importFileInput = document.getElementById('import-file-input');

if (!fileDropZone || !importFileInput) return;

fileDropZone.addEventListener('click', () => {
importFileInput.click();
});

fileDropZone.addEventListener('dragover', (e) => {
e.preventDefault();
fileDropZone.classList.add('dragover');
});

fileDropZone.addEventListener('dragleave', () => {
fileDropZone.classList.remove('dragover');
});

fileDropZone.addEventListener('drop', (e) => {
e.preventDefault();
fileDropZone.classList.remove('dragover');

const files = e.dataTransfer.files;
if (files.length > 0) {
handleFileSelect(files[0]);
}
});

importFileInput.addEventListener('change', (e) => {
if (e.target.files.length > 0) {
handleFileSelect(e.target.files[0]);
}
});
}

function handleFileSelect(file) {
const importError = document.getElementById('import-error');
const importStatus = document.getElementById('import-status');

// é‡ç½®é”™è¯¯ä¿¡æ¯
if (importError) importError.classList.remove('show');

// æ£€æŸ¥æ–‡ä»¶ç±»å‹
if (!file.name.match(/\.(xlsx|xls)$/)) {
if (importError) {
importError.textContent = 'è¯·é€‰æ‹©Excelæ–‡ä»¶ï¼ˆ.xlsx æˆ– .xlsï¼‰';
importError.classList.add('show');
}
return;
}

// æ£€æŸ¥æ–‡ä»¶å¤§å°ï¼ˆé™åˆ¶ä¸º10MBï¼‰
if (file.size > 10 * 1024 * 1024) {
if (importError) {
importError.textContent = 'æ–‡ä»¶å¤§å°è¶…è¿‡é™åˆ¶ï¼ˆ10MBï¼‰';
importError.classList.add('show');
}
return;
}

// æ˜¾ç¤ºåŠ è½½çŠ¶æ€
if (importStatus) {
importStatus.style.display = 'block';
importStatus.innerHTML = '<div class="loading" style="margin: 0 auto 0.5rem;"></div><p style="font-size: 0.875rem; color: #6b7280;">æ­£åœ¨è¯»å–æ–‡ä»¶...</p>';
}

const reader = new FileReader();

reader.onload = function(e) {
try {
const data = new Uint8Array(e.target.result);

// æ£€æŸ¥XLSXåº“æ˜¯å¦å·²åŠ è½½
if (typeof XLSX === 'undefined') {
// åŠ¨æ€åŠ è½½XLSXåº“
const script = document.createElement('script');
script.src = 'https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js';
script.onload = function() {
// åº“åŠ è½½å®Œæˆåå¤„ç†Excelæ–‡ä»¶
processExcelData(data);
};
script.onerror = function() {
if (importStatus) importStatus.style.display = 'none';
if (importError) {
importError.textContent = 'æ— æ³•åŠ è½½Excelå¤„ç†åº“ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥';
importError.classList.add('show');
}
};
document.head.appendChild(script);
} else {
// åº“å·²åŠ è½½ï¼Œç›´æ¥å¤„ç†Excelæ–‡ä»¶
processExcelData(data);
}
} catch (error) {
console.error('è¯»å–æ–‡ä»¶é”™è¯¯:', error);
if (importStatus) importStatus.style.display = 'none';
if (importError) {
importError.textContent = 'è¯»å–æ–‡ä»¶å¤±è´¥: ' + error.message;
importError.classList.add('show');
}
}
};

reader.onerror = function() {
if (importStatus) importStatus.style.display = 'none';
if (importError) {
importError.textContent = 'æ–‡ä»¶è¯»å–å¤±è´¥ï¼Œè¯·é‡è¯•';
importError.classList.add('show');
}
};

reader.readAsArrayBuffer(file);
}

function processExcelData(data) {
const importStatus = document.getElementById('import-status');
const importError = document.getElementById('import-error');

try {
if (importStatus) {
importStatus.innerHTML = '<div class="loading" style="margin: 0 auto 0.5rem;"></div><p style="font-size: 0.875rem; color: #6b7280;">æ­£åœ¨è§£æExcelæ–‡ä»¶...</p>';
}

const workbook = XLSX.read(data, { type: 'array' });

if (!workbook.SheetNames || workbook.SheetNames.length === 0) {
throw new Error('Excelæ–‡ä»¶ä¸­æ²¡æœ‰å·¥ä½œè¡¨');
}

const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
const jsonData = XLSX.utils.sheet_to_json(firstSheet);

if (jsonData.length === 0) {
throw new Error('Excelæ–‡ä»¶ä¸­æ²¡æœ‰æ•°æ®');
}

// éªŒè¯æ•°æ®æ ¼å¼ - æ›´çµæ´»çš„åˆ—ååŒ¹é…
const columns = Object.keys(jsonData[0]);
console.log('Excelåˆ—å:', columns);

// å°è¯•åŒ¹é…å¿…éœ€çš„åˆ—
let dateColumn = null;
let wordColumn = null;

// æŸ¥æ‰¾æ—¥æœŸåˆ—
for (const col of columns) {
if (col.includes('æ—¥æœŸ') || col.toLowerCase().includes('date')) {
dateColumn = col;
break;
}
}

// æŸ¥æ‰¾å•è¯åˆ—
for (const col of columns) {
if (col.includes('å•è¯') || col.toLowerCase().includes('word')) {
wordColumn = col;
break;
}
}

if (!dateColumn || !wordColumn) {
throw new Error(`Excelæ–‡ä»¶æ ¼å¼ä¸æ­£ç¡®ï¼Œå¿…é¡»åŒ…å«"æ—¥æœŸ"å’Œ"å•è¯"åˆ—ã€‚æ‰¾åˆ°çš„åˆ—: ${columns.join(', ')}`);
}

// æ ‡å‡†åŒ–æ•°æ®æ ¼å¼
const standardizedData = jsonData.map(row => {
const newRow = {};

// æ ‡å‡†åŒ–æ—¥æœŸåˆ—
newRow['æ—¥æœŸ'] = row[dateColumn];

// æ ‡å‡†åŒ–å•è¯åˆ—
newRow['å•è¯'] = row[wordColumn];

// æ ‡å‡†åŒ–å…¶ä»–åˆ—
for (const col of columns) {
if (col === dateColumn || col === wordColumn) continue;

if (col.includes('é‡Šä¹‰') || col.toLowerCase().includes('meaning')) {
newRow['é‡Šä¹‰'] = row[col];
} else if (col.includes('åŒä¹‰è¯') || col.toLowerCase().includes('synonym')) {
newRow['åŒä¹‰è¯'] = row[col];
} else if (col.includes('è¯ç»„') || col.toLowerCase().includes('phrase')) {
newRow['è¯ç»„'] = row[col];
} else if (col.includes('æŒæ¡') || col.toLowerCase().includes('master')) {
newRow['æŒæ¡çŠ¶æ€'] = row[col];
} else {
// å¦‚æœåˆ—ä¸åŒ¹é…ä»»ä½•å·²çŸ¥åˆ—ï¼Œä¿ç•™åŸåˆ—å
newRow[col] = row[col];
}
}

return newRow;
});

importData = standardizedData;
showImportPreview(standardizedData);
if (importStatus) importStatus.style.display = 'none';
} catch (error) {
console.error('å¤„ç†Excelæ•°æ®é”™è¯¯:', error);
if (importStatus) importStatus.style.display = 'none';
if (importError) {
importError.textContent = 'è§£æExcelæ–‡ä»¶å¤±è´¥: ' + error.message;
importError.classList.add('show');
}
}
}

function showImportPreview(data) {
const importPreview = document.getElementById('import-preview');
const previewTable = document.getElementById('preview-table');
const importSummary = document.getElementById('import-summary');

if (!importPreview || !previewTable || !importSummary) return;

// åˆ›å»ºé¢„è§ˆè¡¨æ ¼
let tableHTML = `
<thead>
<tr>
<th>æ—¥æœŸ</th>
<th>å•è¯</th>
<th>é‡Šä¹‰</th>
<th>åŒä¹‰è¯</th>
<th>è¯ç»„</th>
<th>æŒæ¡çŠ¶æ€</th>
</tr>
</thead>
<tbody>
`;

// åªæ˜¾ç¤ºå‰10è¡Œä½œä¸ºé¢„è§ˆ
const previewRows = data.slice(0, 10);
previewRows.forEach(row => {
tableHTML += `
<tr>
<td>${row['æ—¥æœŸ'] || ''}</td>
<td>${row['å•è¯'] || ''}</td>
<td>${row['é‡Šä¹‰'] || ''}</td>
<td>${row['åŒä¹‰è¯'] || ''}</td>
<td>${row['è¯ç»„'] || ''}</td>
<td>${row['æŒæ¡çŠ¶æ€'] || ''}</td>
</tr>
`;
});

tableHTML += '</tbody>';
previewTable.innerHTML = tableHTML;

// æ˜¾ç¤ºå¯¼å…¥æ‘˜è¦
const importOption = document.querySelector('input[name="import-option"]:checked').value;
let summaryText = `å…± ${data.length} æ¡æ•°æ®`;

if (importOption === 'merge') {
// è®¡ç®—å°†å¯¼å…¥çš„æ–°æ•°æ®é‡
let newWordCount = 0;
data.forEach(row => {
const date = row['æ—¥æœŸ'];
const word = row['å•è¯'];
if (date && word) {
if (!wordsData[date] || !wordsData[date].some(w => w.word === word)) {
newWordCount++;
}
}
});
summaryText += `ï¼Œå…¶ä¸­ ${newWordCount} æ¡ä¸ºæ–°æ•°æ®`;
}

importSummary.textContent = summaryText;
importPreview.style.display = 'block';
}

async function handleImport() {
if (!importData) return;

const importOption = document.querySelector('input[name="import-option"]:checked').value;
const importPreview = document.getElementById('import-preview');
const importStatus = document.getElementById('import-status');
const importError = document.getElementById('import-error');

try {
if (importPreview) importPreview.style.display = 'none';
if (importStatus) importStatus.style.display = 'block';

if (importOption === 'replace') {
wordsData = {};
}

// å¤„ç†å¯¼å…¥æ•°æ®
let importCount = 0;
let skipCount = 0;

for (const row of importData) {
const date = row['æ—¥æœŸ'];
const word = row['å•è¯'];

if (!date || !word) continue;

if (!wordsData[date]) {
wordsData[date] = [];
}

// æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨ï¼ˆåˆå¹¶æ¨¡å¼ï¼‰
if (importOption === 'merge') {
const exists = wordsData[date].some(w => w.word === word);
if (exists) {
skipCount++;
continue;
}
}

// åˆ›å»ºæ–°å•è¯å¯¹è±¡
const newWord = {
id: Date.now() + Math.random(),
word: word,
meaning: row['é‡Šä¹‰'] || '',
synonym: row['åŒä¹‰è¯'] || '',
phrase: row['è¯ç»„'] || '',
mastered: row['æŒæ¡çŠ¶æ€'] === 'å·²æŒæ¡'
};

wordsData[date].push(newWord);
importCount++;
}

// ä¿å­˜åˆ°äº‘ç«¯æˆ–æœ¬åœ°
await saveUserWords();

// æ˜¾ç¤ºç»“æœ
let message = `æˆåŠŸå¯¼å…¥ ${importCount} æ¡æ•°æ®`;
if (skipCount > 0) {
message += `ï¼Œè·³è¿‡ ${skipCount} æ¡é‡å¤æ•°æ®`;
}

showSyncStatus(message, 3000);

// åˆ·æ–°æ˜¾ç¤º
renderWords();

// å…³é—­æ¨¡æ€æ¡†
setTimeout(() => {
hideImportModal();
}, 1000);

} catch (error) {
console.error('å¯¼å…¥æ•°æ®é”™è¯¯:', error);
if (importError) {
importError.textContent = 'å¯¼å…¥å¤±è´¥: ' + error.message;
importError.classList.add('show');
}
} finally {
if (importStatus) importStatus.style.display = 'none';
}
}

// åˆ›å»ºå¹¶ä¸‹è½½Excelæ–‡ä»¶
function createAndDownloadExcel(data, fileName) {
// æ£€æŸ¥æ˜¯å¦å·²åŠ è½½XLSXåº“
if (typeof XLSX === 'undefined') {
// åŠ¨æ€åŠ è½½XLSXåº“
const script = document.createElement('script');
script.src = 'https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js';
script.onload = function() {
// åº“åŠ è½½å®Œæˆååˆ›å»ºExcelæ–‡ä»¶
createExcelFile(data, fileName);
};
script.onerror = function() {
alert('æ— æ³•åŠ è½½Excelå¯¼å‡ºåº“ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥');
};
document.head.appendChild(script);
} else {
// åº“å·²åŠ è½½ï¼Œç›´æ¥åˆ›å»ºExcelæ–‡ä»¶
createExcelFile(data, fileName);
}
}

// åˆ›å»ºExcelæ–‡ä»¶
function createExcelFile(data, fileName) {
try {
const ws = XLSX.utils.json_to_sheet(data);
const wb = XLSX.utils.book_new();
XLSX.utils.book_append_sheet(wb, ws, "å•è¯è®°å½•");
XLSX.writeFile(wb, fileName);
} catch (error) {
console.error('åˆ›å»ºExcelæ–‡ä»¶å¤±è´¥:', error);
alert('åˆ›å»ºExcelæ–‡ä»¶å¤±è´¥: ' + error.message);
}
}

console.log('åº”ç”¨åˆå§‹åŒ–å®Œæˆ');
</script>

</body>


</html>
